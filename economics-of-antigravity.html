<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Economics of Antigravity - Patrick Young</title>

    <!-- SEO -->
    <meta name="description" content="An interactive analysis of how antigravity technology would reshape civilization, destroy industries, and face institutional resistance.">
    <meta name="author" content="Patrick Young">
    <link rel="canonical" href="https://patrickyoung.ai/economics-of-antigravity.html">

    <!-- Open Graph -->
    <meta property="og:title" content="The Economics of Antigravity - Patrick Young">
    <meta property="og:description" content="An interactive analysis of how antigravity technology would reshape civilization and face institutional resistance.">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://patrickyoung.ai/economics-of-antigravity.html">
    <meta property="og:image" content="https://patrickyoung.ai/og-image.png">

    <!-- Twitter -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="The Economics of Antigravity - Patrick Young">
    <meta name="twitter:description" content="An interactive analysis of how antigravity technology would reshape civilization and face institutional resistance.">
    <meta name="twitter:image" content="https://patrickyoung.ai/og-image.png">

    <!-- Font preloading -->
    <link rel="preload" href="/fonts/BerkeleyMono-Regular.woff2" as="font" type="font/woff2" crossorigin>
    <link rel="preload" href="/fonts/BerkeleyMono-Bold.woff2" as="font" type="font/woff2" crossorigin>

    <style>
        @font-face {
            font-family: 'Berkeley Mono';
            src: url('/fonts/BerkeleyMono-Regular.woff2') format('woff2');
            font-weight: normal;
            font-display: swap;
        }
        @font-face {
            font-family: 'Berkeley Mono';
            src: url('/fonts/BerkeleyMono-Bold.woff2') format('woff2');
            font-weight: bold;
            font-display: swap;
        }

        :root {
            --parchment: #f4e4bc;
            --parchment-dark: #d4c4a0;
            --parchment-edge: #c4a470;
            --ink: #2c1810;
            --ink-faded: #4a3828;
            --ink-light: #6b5340;
            --stamp-red: #8b0000;
            --classified-red: #cc0000;
            --pencil: #4a4a4a;
            --coffee-stain: rgba(139, 90, 43, 0.12);
            --fold-shadow: rgba(0, 0, 0, 0.08);
            --disruption-low: #3d5c3d;
            --disruption-mid: #8b7500;
            --disruption-high: #8b0000;
            --flow-transport: #4a7c9b;
            --flow-realestate: #7b5c3d;
            --flow-energy: #9b7c3d;
            --flow-labor: #5c4a7c;
            --flow-supply: #3d7c6b;
            --flow-military: #7c3d3d;
            --flow-space: #3d4a7c;
            --flow-urban: #6b7c3d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            font-family: 'Berkeley Mono', 'Courier New', monospace;
            background:
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 2px,
                    rgba(0,0,0,0.01) 2px,
                    rgba(0,0,0,0.01) 4px
                ),
                linear-gradient(135deg, var(--parchment) 0%, var(--parchment-dark) 50%, var(--parchment) 100%);
            background-attachment: fixed;
            color: var(--ink);
            line-height: 1.6;
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background:
                radial-gradient(ellipse at 20% 30%, var(--coffee-stain) 0%, transparent 40%),
                radial-gradient(ellipse at 85% 70%, var(--coffee-stain) 0%, transparent 35%),
                radial-gradient(ellipse at 60% 90%, rgba(139, 90, 43, 0.08) 0%, transparent 30%);
            pointer-events: none;
            z-index: 1;
        }

        .document-container {
            max-width: 900px;
            margin: 0 auto;
            padding: 40px 20px;
            position: relative;
            z-index: 2;
        }

        .fold-line {
            position: fixed;
            left: 50%;
            top: 0;
            bottom: 0;
            width: 1px;
            background: linear-gradient(
                to bottom,
                transparent 0%,
                var(--fold-shadow) 10%,
                var(--fold-shadow) 90%,
                transparent 100%
            );
            pointer-events: none;
            z-index: 3;
        }

        .fold-line::after {
            content: '';
            position: absolute;
            left: 1px;
            top: 0;
            bottom: 0;
            width: 1px;
            background: linear-gradient(
                to bottom,
                transparent 0%,
                rgba(255,255,255,0.3) 10%,
                rgba(255,255,255,0.3) 90%,
                transparent 100%
            );
        }

        /* Header */
        .document-header {
            text-align: center;
            padding: 40px 20px;
            border: 3px double var(--ink);
            margin-bottom: 40px;
            position: relative;
            background: linear-gradient(to bottom, rgba(255,255,255,0.1), transparent);
        }

        .document-header::before {
            content: 'CLASSIFIED';
            position: absolute;
            top: -12px;
            left: 50%;
            transform: translateX(-50%) rotate(-2deg);
            background: var(--classified-red);
            color: white;
            padding: 4px 20px;
            font-size: 14px;
            font-weight: bold;
            letter-spacing: 3px;
            box-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .stamp {
            position: absolute;
            font-weight: bold;
            text-transform: uppercase;
            letter-spacing: 2px;
            opacity: 0.7;
            pointer-events: none;
        }

        .stamp-top-secret {
            top: 20px;
            right: 20px;
            color: var(--stamp-red);
            font-size: 18px;
            transform: rotate(12deg);
            border: 3px solid var(--stamp-red);
            padding: 5px 10px;
            border-radius: 4px;
        }

        .stamp-eyes-only {
            bottom: 20px;
            left: 20px;
            color: var(--ink-faded);
            font-size: 12px;
            transform: rotate(-8deg);
            border: 2px solid var(--ink-faded);
            padding: 3px 8px;
        }

        .document-title {
            font-size: 28px;
            font-weight: bold;
            letter-spacing: 4px;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .document-subtitle {
            font-size: 16px;
            color: var(--ink-faded);
            letter-spacing: 2px;
            margin-bottom: 20px;
        }

        .document-meta {
            font-size: 12px;
            color: var(--ink-light);
            display: flex;
            justify-content: center;
            gap: 30px;
            flex-wrap: wrap;
        }

        .document-meta span {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        /* Manila Folder Tabs */
        .folder-tabs {
            display: flex;
            align-items: flex-end;
            gap: 0;
            margin: 10px 0 0;
            padding-left: 8px;
            position: relative;
            z-index: 10;
            background: var(--parchment);
        }

        .folder-tabs::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            bottom: 0;
            height: 3px;
            background: var(--parchment);
            z-index: 2;
        }

        .folder-tab {
            -webkit-appearance: none;
            appearance: none;
            border: 2px solid var(--ink-faded);
            border-bottom: none;
            border-radius: 12px 12px 0 0;
            background:
                repeating-linear-gradient(
                    0deg,
                    rgba(44, 24, 16, 0.03) 0px,
                    rgba(44, 24, 16, 0.03) 1px,
                    transparent 1px,
                    transparent 7px
                ),
                linear-gradient(135deg, #f6e8c7 0%, #e8d3a1 55%, #f4e4bc 100%);
            color: var(--ink);
            font-family: inherit;
            font-size: 12px;
            letter-spacing: 4px;
            text-transform: uppercase;
            padding: 12px 18px 10px;
            cursor: pointer;
            position: relative;
            z-index: 1;
            box-shadow: 0 2px 0 rgba(0,0,0,0.06);
            transition: transform 0.15s ease, box-shadow 0.15s ease, border-color 0.15s ease;
        }

        .folder-tab + .folder-tab {
            margin-left: -14px;
        }

        .folder-tab::before {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 12px 12px 0 0;
            background: radial-gradient(ellipse at 30% 20%, rgba(255,255,255,0.35) 0%, transparent 55%);
            pointer-events: none;
            opacity: 0.5;
        }

        .folder-tab.active,
        .folder-tab[aria-selected="true"] {
            z-index: 5;
            transform: translateY(-3px);
            border-color: var(--ink);
            box-shadow: 0 4px 12px rgba(0,0,0,0.12);
            background:
                repeating-linear-gradient(
                    0deg,
                    rgba(44, 24, 16, 0.035) 0px,
                    rgba(44, 24, 16, 0.035) 1px,
                    transparent 1px,
                    transparent 6px
                ),
                linear-gradient(135deg, #fff0c9 0%, #f0dbac 60%, #f6e8c7 100%);
        }

        .folder-tab.active::after,
        .folder-tab[aria-selected="true"]::after {
            content: '';
            position: absolute;
            left: 0;
            right: 0;
            bottom: -3px;
            height: 5px;
            background: var(--parchment);
        }

        .folder-tab:hover {
            border-color: var(--ink);
            transform: translateY(-1px);
        }

        .folder-tab.active:hover,
        .folder-tab[aria-selected="true"]:hover {
            transform: translateY(-3px);
        }

        .folder-tab:focus-visible {
            outline: 2px solid var(--classified-red);
            outline-offset: 3px;
        }

        /* Main Layout with Sidebar */
        .main-layout {
            display: flex;
            gap: 20px;
            align-items: flex-start;
            position: relative;
            background: var(--parchment);
            padding-top: 25px;
            margin-top: 0;
        }

        /* Timeline Sidebar */
        .horizon-panel {
            position: sticky;
            top: 20px;
            width: 70px;
            flex-shrink: 0;
            padding: 10px 8px;
            background: var(--parchment);
            border: 2px solid var(--ink-faded);
            border-radius: 4px;
        }

        .horizon-header {
            display: none;
        }

        .horizon-scrubber {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .horizon-marker {
            -webkit-appearance: none;
            appearance: none;
            border: 2px solid rgba(44,24,16,0.35);
            background: linear-gradient(135deg, #f4e4bc 0%, #e7d2a1 70%, #f4e4bc 100%);
            color: var(--ink);
            border-radius: 4px;
            padding: 8px 6px;
            cursor: pointer;
            box-shadow: 1px 2px 0 rgba(0,0,0,0.06);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0;
            transition: all 0.15s ease;
            text-align: center;
        }

        .horizon-marker .horizon-marker-year {
            font-size: 16px;
            font-weight: bold;
            line-height: 1;
        }

        .horizon-marker .horizon-marker-label {
            font-size: 8px;
            letter-spacing: 1px;
            text-transform: uppercase;
            color: var(--ink-faded);
            line-height: 1;
        }

        .horizon-marker:hover {
            border-color: var(--ink);
            background: linear-gradient(135deg, #f8eacc 0%, #ebdaad 70%, #f8eacc 100%);
        }

        .horizon-marker.active,
        .horizon-marker[aria-checked="true"] {
            border-color: var(--classified-red);
            background: linear-gradient(135deg, #fff0c9 0%, #f0dbac 70%, #f6e8c7 100%);
            box-shadow: 0 0 0 2px var(--parchment), 0 0 0 4px var(--classified-red);
        }

        .horizon-marker:focus-visible {
            outline: 2px solid var(--classified-red);
            outline-offset: 2px;
        }

        /* Tab Panels */
        .tab-content {
            position: relative;
            flex: 1;
            min-width: 0;
        }

        .tab-panel[hidden] {
            display: none !important;
        }

        /* Collapsible Control Panel */
        details.control-panel > summary {
            list-style: none;
        }

        details.control-panel > summary::-webkit-details-marker {
            display: none;
        }

        .control-summary {
            cursor: pointer;
            user-select: none;
        }

        .control-summary .control-header {
            position: relative;
            margin-bottom: 0;
            padding-bottom: 15px;
            border-bottom: 1px dashed var(--ink-faded);
        }

        .control-summary .control-header::after {
            content: '▾';
            position: absolute;
            right: 0;
            top: 50%;
            transform: translateY(-50%);
            font-size: 16px;
            color: var(--ink-faded);
        }

        details.control-panel:not([open]) .control-summary .control-header::after {
            content: '▸';
        }

        details.control-panel[open] .control-body {
            margin-top: 25px;
        }

        /* Hide nav when not on ECONOMIC tab */
        .nav-sidebar.hidden {
            display: none;
        }

        /* Navigation */
        .nav-sidebar {
            position: fixed;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .nav-dot {
            width: 12px;
            height: 12px;
            border: 2px solid var(--ink-faded);
            border-radius: 50%;
            background: transparent;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .nav-dot:hover,
        .nav-dot.active {
            background: var(--ink);
            border-color: var(--ink);
        }

        .nav-dot::after {
            content: attr(data-label);
            position: absolute;
            left: 20px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 10px;
            white-space: nowrap;
            opacity: 0;
            transition: opacity 0.3s ease;
            color: var(--ink-faded);
        }

        .nav-dot:hover::after,
        .nav-dot:focus::after {
            opacity: 1;
        }

        .nav-dot:focus {
            outline: 2px solid var(--ink);
            outline-offset: 2px;
        }

        .nav-dot:focus:not(:focus-visible) {
            outline: none;
        }

        .nav-dot:focus-visible {
            outline: 2px solid var(--ink);
            outline-offset: 2px;
        }

        /* Control Panel */
        .control-panel {
            background:
                linear-gradient(to bottom, rgba(0,0,0,0.02), transparent),
                var(--parchment-dark);
            border: 2px solid var(--ink-faded);
            padding: 30px;
            margin-bottom: 40px;
            position: relative;
        }

        .control-panel::before {
            content: 'OPERATION ICARUS';
            position: absolute;
            top: -10px;
            left: 20px;
            background: var(--parchment);
            padding: 0 10px;
            font-size: 12px;
            letter-spacing: 2px;
            color: var(--ink-faded);
            z-index: 1;
        }

        .control-header {
            text-align: center;
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px dashed var(--ink-faded);
        }

        .control-header h2 {
            font-size: 16px;
            letter-spacing: 3px;
            text-transform: uppercase;
        }

        .control-grid {
            display: grid;
            gap: 20px;
        }

        .control-row {
            display: grid;
            grid-template-columns: 180px 1fr 80px;
            align-items: center;
            gap: 15px;
        }

        .control-label {
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--ink-faded);
        }

        .control-slider {
            position: relative;
            height: 24px;
        }

        .control-slider input[type="range"] {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 8px;
            background: var(--parchment);
            border: 1px solid var(--ink-faded);
            border-radius: 0;
            cursor: pointer;
        }

        .control-slider input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            background: var(--ink);
            border: 2px solid var(--parchment);
            cursor: pointer;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        .control-slider input[type="range"]::-moz-range-thumb {
            width: 20px;
            height: 20px;
            background: var(--ink);
            border: 2px solid var(--parchment);
            cursor: pointer;
            box-shadow: 1px 1px 3px rgba(0,0,0,0.3);
        }

        .control-value {
            font-size: 14px;
            font-weight: bold;
            text-align: right;
            min-width: 80px;
        }

        .control-select {
            position: relative;
        }

        .control-select select {
            width: 100%;
            padding: 8px 12px;
            font-family: inherit;
            font-size: 12px;
            background: var(--parchment);
            border: 1px solid var(--ink-faded);
            color: var(--ink);
            cursor: pointer;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .recalculate-btn {
            display: block;
            width: 100%;
            margin-top: 25px;
            padding: 12px;
            background: var(--ink);
            color: var(--parchment);
            border: none;
            font-family: inherit;
            font-size: 14px;
            letter-spacing: 3px;
            text-transform: uppercase;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .recalculate-btn:hover {
            background: var(--stamp-red);
        }

        /* Sections */
        .section {
            margin-bottom: 60px;
            padding: 30px;
            position: relative;
            background: rgba(255,255,255,0.05);
            border-left: 3px solid var(--ink-faded);
            transition: opacity 0.3s ease, transform 0.3s ease;
        }

        .section[data-year] {
            transform-origin: top left;
        }

        .section[hidden] {
            display: none !important;
        }

        .section::before {
            content: attr(data-section-num);
            position: absolute;
            top: -15px;
            left: -15px;
            width: 30px;
            height: 30px;
            background: var(--ink);
            color: var(--parchment);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 14px;
            font-weight: bold;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 1px solid var(--ink-faded);
        }

        .section-title {
            font-size: 20px;
            font-weight: bold;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .section-status {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--disruption-low);
        }

        .status-indicator.mid { background: var(--disruption-mid); }
        .status-indicator.high { background: var(--disruption-high); }

        /* Disruption Meter */
        .disruption-meter {
            margin: 20px 0;
            padding: 15px;
            background: var(--parchment);
            border: 1px solid var(--ink-faded);
        }

        .meter-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--ink-faded);
        }

        .meter-track {
            height: 24px;
            background:
                repeating-linear-gradient(
                    90deg,
                    var(--parchment-dark) 0px,
                    var(--parchment-dark) 1px,
                    transparent 1px,
                    transparent 10px
                ),
                linear-gradient(to right,
                    var(--disruption-low) 0%,
                    var(--disruption-low) 33%,
                    var(--disruption-mid) 33%,
                    var(--disruption-mid) 66%,
                    var(--disruption-high) 66%,
                    var(--disruption-high) 100%
                );
            position: relative;
            border: 1px solid var(--ink-faded);
        }

        .meter-fill {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: var(--ink);
            opacity: 0.85;
            transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .meter-value {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            font-size: 14px;
            font-weight: bold;
            color: var(--parchment);
            text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
            z-index: 1;
        }

        .meter-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 5px;
            font-size: 9px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--ink-light);
        }

        /* Narrative Text */
        .narrative {
            margin: 20px 0;
            padding: 15px 20px;
            background: rgba(255,255,255,0.1);
            border-left: 2px solid var(--ink-light);
            font-style: italic;
            color: var(--ink-faded);
            position: relative;
        }

        .narrative::before {
            content: '"';
            position: absolute;
            top: 5px;
            left: 5px;
            font-size: 30px;
            opacity: 0.3;
        }

        /* Impact List */
        .impact-list {
            list-style: none;
            margin: 15px 0;
        }

        .impact-item {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px dashed var(--parchment-dark);
        }

        .impact-marker {
            width: 8px;
            height: 8px;
            background: var(--ink);
            margin-top: 6px;
            flex-shrink: 0;
        }

        .impact-text strong {
            display: block;
            font-size: 13px;
            margin-bottom: 3px;
        }

        .impact-text span {
            font-size: 12px;
            color: var(--ink-faded);
        }

        /* Accessibility */
        .skip-link {
            position: absolute;
            top: -40px;
            left: 0;
            background: var(--ink);
            color: var(--parchment);
            padding: 8px 16px;
            z-index: 1000;
            text-decoration: none;
        }

        .skip-link:focus {
            top: 0;
        }

        .visually-hidden {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }

        /* Redacted Text */
        .redacted {
            background: var(--ink);
            color: var(--ink);
            padding: 0 4px;
            cursor: pointer;
            transition: all 0.3s ease;
            user-select: none;
        }

        .redacted:hover,
        .redacted:focus {
            background: var(--classified-red);
            color: var(--parchment);
            outline: 2px solid var(--classified-red);
            outline-offset: 2px;
        }

        .redacted.revealed {
            background: var(--classified-red);
            color: var(--parchment);
        }

        /* Sankey Diagram Container */
        .sankey-container {
            margin: 30px 0;
            padding: 20px;
            background: var(--parchment);
            border: 2px solid var(--ink-faded);
            position: relative;
        }

        .sankey-container::before {
            content: 'ECONOMIC FLOW ANALYSIS';
            position: absolute;
            top: -10px;
            left: 20px;
            background: var(--parchment);
            padding: 0 10px;
            font-size: 10px;
            letter-spacing: 2px;
            color: var(--ink-faded);
        }

        .sankey-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .sankey-header span {
            padding: 4px 12px;
            background: var(--ink-faded);
            color: var(--parchment);
        }

        #sankey-diagram {
            width: 100%;
            height: 400px;
        }

        #sankey-diagram .sankey-flow {
            stroke: rgba(255, 255, 255, 0.55);
            stroke-dasharray: 7 18;
            stroke-linecap: round;
            stroke-linejoin: round;
            fill: none;
            pointer-events: none;
            opacity: 0.85;
            animation: sankey-flow 1.8s linear infinite;
        }

        @media (prefers-reduced-motion: reduce) {
            #sankey-diagram .sankey-flow { animation: none; }
        }

        /* World Map */
        .map-container {
            margin: 30px 0;
            padding: 20px;
            background: var(--parchment);
            border: 2px solid var(--ink-faded);
            position: relative;
        }

        .map-container::before {
            content: 'GEOGRAPHIC DIFFUSION MAP';
            position: absolute;
            top: -10px;
            left: 20px;
            background: var(--parchment);
            padding: 0 10px;
            font-size: 10px;
            letter-spacing: 2px;
            color: var(--ink-faded);
        }

        .map-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-size: 11px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .map-header span {
            padding: 4px 12px;
            background: var(--ink-faded);
            color: var(--parchment);
        }

        .map-grid {
            display: grid;
            grid-template-columns: 1.4fr 0.9fr;
            gap: 16px;
            align-items: start;
        }

        .map-canvas-wrap {
            border: 1px solid var(--ink-faded);
            background: linear-gradient(to bottom, rgba(255,255,255,0.08), transparent);
            padding: 10px;
            position: relative;
        }

        #world-map {
            width: 100%;
            height: 420px;
            display: block;
            background: rgba(255,255,255,0.06);
        }

        .map-caption {
            margin-top: 8px;
            font-size: 10px;
            color: var(--ink-light);
            letter-spacing: 0.5px;
        }

        .map-legend {
            border: 1px solid var(--ink-faded);
            padding: 12px;
            background: rgba(255,255,255,0.05);
        }

        .legend-block + .legend-block {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 1px dashed rgba(44,24,16,0.25);
        }

        .legend-title {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--ink-faded);
            margin-bottom: 6px;
        }

        .legend-bar {
            height: 10px;
            border: 1px solid rgba(44,24,16,0.35);
            background: linear-gradient(to right, var(--parchment) 0%, rgba(74,124,155,0.65) 50%, var(--flow-transport) 100%);
        }

        .legend-hatch {
            height: 18px;
            border: 1px solid rgba(44,24,16,0.35);
            background:
                repeating-linear-gradient(
                    135deg,
                    rgba(139,0,0,0.00) 0px,
                    rgba(139,0,0,0.00) 6px,
                    rgba(139,0,0,0.20) 6px,
                    rgba(139,0,0,0.20) 8px
                );
        }

        .legend-labels {
            display: flex;
            justify-content: space-between;
            font-size: 10px;
            color: var(--ink-light);
            margin-top: 6px;
        }

        .region-readout {
            margin-top: 14px;
            font-size: 11px;
            line-height: 1.5;
        }

        .region-row {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px dotted rgba(44,24,16,0.18);
        }

        .region-row:last-child {
            border-bottom: none;
        }

        .region-name {
            color: var(--ink);
            font-weight: bold;
        }

        .region-metrics {
            text-align: right;
            color: var(--ink-faded);
            font-size: 10px;
            letter-spacing: 0.5px;
        }

        /* Historical Analogues */
        .analogues-container {
            margin: 30px 0;
            padding: 20px;
            background: var(--parchment);
            border: 2px solid var(--ink-faded);
            position: relative;
        }

        .analogues-container::before {
            content: 'REFERENCE CURVES';
            position: absolute;
            top: -10px;
            left: 20px;
            background: var(--parchment);
            padding: 0 10px;
            font-size: 10px;
            letter-spacing: 2px;
            color: var(--ink-faded);
        }

        .analogues-header {
            text-align: center;
            font-size: 14px;
            letter-spacing: 2px;
            text-transform: uppercase;
            margin-bottom: 8px;
        }

        .analogues-subtitle {
            font-size: 11px;
            color: var(--ink-light);
            text-align: center;
            margin-bottom: 14px;
        }

        .sparkline-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 14px;
        }

        .sparkline-card {
            border: 1px solid var(--ink-faded);
            background: rgba(255,255,255,0.05);
            padding: 12px;
        }

        .sparkline-meta {
            display: flex;
            justify-content: space-between;
            align-items: baseline;
            margin-bottom: 8px;
        }

        .sparkline-title {
            font-weight: bold;
            letter-spacing: 1px;
            text-transform: uppercase;
            font-size: 11px;
        }

        .sparkline-range {
            font-size: 10px;
            color: var(--ink-faded);
            letter-spacing: 0.5px;
        }

        canvas.sparkline {
            width: 100%;
            height: 90px;
            display: block;
            background: rgba(255,255,255,0.06);
            border: 1px solid rgba(44,24,16,0.22);
        }

        /* Timeline */
        .timeline-container {
            margin: 30px 0;
            padding: 20px;
            background: var(--parchment);
            border: 2px solid var(--ink-faded);
        }

        .timeline-header {
            text-align: center;
            margin-bottom: 20px;
            font-size: 14px;
            letter-spacing: 2px;
            text-transform: uppercase;
        }

        .timeline-viz {
            display: grid;
            grid-template-columns: 1.35fr 0.85fr;
            gap: 16px;
            align-items: start;
        }

        #cascade-timeline {
            width: 100%;
            height: 240px;
            border: 1px solid var(--ink-faded);
            background: linear-gradient(to bottom, rgba(255,255,255,0.08), transparent);
            display: block;
        }

        .timeline-notes {
            border: 1px solid var(--ink-faded);
            background: rgba(255,255,255,0.05);
            padding: 12px;
            font-size: 11px;
            line-height: 1.55;
        }

        .timeline-notes .notes-title {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--ink-faded);
            margin-bottom: 8px;
        }

        .timeline-notes .notes-section {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed rgba(44,24,16,0.25);
        }

        .timeline-notes .notes-section:first-of-type {
            margin-top: 0;
            padding-top: 0;
            border-top: none;
        }

        .timeline-notes .event-line {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            padding: 6px 0;
            border-bottom: 1px dotted rgba(44,24,16,0.18);
        }

        .timeline-notes .event-line:last-child {
            border-bottom: none;
        }

        .timeline-notes .event-name {
            font-weight: bold;
            color: var(--ink);
        }

        .timeline-notes .event-year {
            color: var(--ink-faded);
            font-size: 10px;
            letter-spacing: 0.5px;
            white-space: nowrap;
        }

        .timeline-track {
            position: relative;
            height: 60px;
            margin: 30px 0;
        }

        .timeline-line {
            position: absolute;
            top: 50%;
            left: 0;
            right: 0;
            height: 2px;
            background: var(--ink-faded);
        }

        .timeline-marker {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 16px;
            height: 16px;
            background: var(--ink);
            border: 2px solid var(--parchment);
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .timeline-marker:hover {
            transform: translate(-50%, -50%) scale(1.3);
            background: var(--stamp-red);
        }

        .timeline-marker-label {
            position: absolute;
            top: 100%;
            left: 50%;
            transform: translateX(-50%);
            margin-top: 10px;
            font-size: 10px;
            white-space: nowrap;
            text-align: center;
        }

        .timeline-scrubber {
            width: 100%;
            margin-top: 20px;
        }

        .timeline-scrubber input[type="range"] {
            width: 100%;
        }

        .timeline-year-display {
            text-align: center;
            font-size: 24px;
            font-weight: bold;
            margin-top: 10px;
        }

        /* Job Counter */
        .job-counter {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }

        .counter-box {
            padding: 15px;
            text-align: center;
            background: var(--parchment);
            border: 1px solid var(--ink-faded);
        }

        .counter-label {
            font-size: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: var(--ink-faded);
            margin-bottom: 8px;
        }

        .counter-value {
            font-size: 28px;
            font-weight: bold;
        }

        .counter-value.negative { color: var(--disruption-high); }
        .counter-value.positive { color: var(--disruption-low); }
        .counter-value.neutral { color: var(--ink); }

        .counter-unit {
            font-size: 11px;
            color: var(--ink-faded);
        }

        /* Annotation */
        .annotation {
            position: absolute;
            font-size: 11px;
            color: var(--pencil);
            font-style: italic;
            transform: rotate(-3deg);
            opacity: 0.8;
        }

        /* Paper Clip */
        .paper-clip {
            position: absolute;
            top: -10px;
            right: 30px;
            width: 30px;
            height: 60px;
            border: 3px solid #888;
            border-radius: 15px 15px 0 0;
            border-bottom: none;
            transform: rotate(10deg);
            opacity: 0.5;
        }

        /* Footer */
        .document-footer {
            margin-top: 60px;
            padding: 30px;
            border-top: 2px solid var(--ink-faded);
            text-align: center;
        }

        .footer-stamp {
            display: inline-block;
            padding: 10px 30px;
            border: 3px solid var(--stamp-red);
            color: var(--stamp-red);
            font-weight: bold;
            letter-spacing: 3px;
            transform: rotate(-5deg);
            opacity: 0.8;
        }

        .footer-text {
            margin-top: 20px;
            font-size: 11px;
            color: var(--ink-light);
            letter-spacing: 1px;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .nav-sidebar {
                display: none;
            }

            .main-layout {
                flex-direction: column;
            }

            .horizon-panel {
                position: relative;
                top: 0;
                width: 100%;
                margin-right: 0;
                margin-bottom: 15px;
                border-radius: 4px;
            }

            .horizon-scrubber {
                flex-direction: row;
                flex-wrap: wrap;
                justify-content: center;
                gap: 8px;
            }

            .horizon-marker {
                flex-direction: row;
                padding: 6px 10px;
                gap: 4px;
            }

            .horizon-marker .horizon-marker-year {
                font-size: 14px;
            }

            .folder-tabs {
                padding-left: 0;
                justify-content: center;
            }

            .folder-tab + .folder-tab {
                margin-left: -10px;
            }

            .document-container {
                padding: 20px 15px;
            }

            .control-row {
                grid-template-columns: 1fr;
                gap: 8px;
            }

            .control-value {
                text-align: left;
            }

            .job-counter {
                grid-template-columns: 1fr;
            }

            .sankey-header {
                flex-direction: column;
                gap: 10px;
            }

            #sankey-diagram {
                height: 300px;
            }

            .map-grid {
                grid-template-columns: 1fr;
            }

            #world-map {
                height: 320px;
            }

            .sparkline-grid {
                grid-template-columns: 1fr;
            }

            .timeline-viz {
                grid-template-columns: 1fr;
            }

            #cascade-timeline {
                height: 280px;
            }
        }

        /* Animations */
        @keyframes typewriter {
            from { width: 0; }
            to { width: 100%; }
        }

        @keyframes stamp-slam {
            0% { transform: scale(3) rotate(var(--rotation, 0deg)); opacity: 0; }
            50% { transform: scale(0.9) rotate(var(--rotation, 0deg)); }
            100% { transform: scale(1) rotate(var(--rotation, 0deg)); opacity: 0.7; }
        }

        .stamp-animate {
            animation: stamp-slam 0.4s ease-out forwards;
        }

        @keyframes ink-fill {
            from { width: 0; }
        }

        .meter-fill {
            animation: ink-fill 1s ease-out;
        }

        @keyframes sankey-flow {
            from { stroke-dashoffset: 0; }
            to { stroke-dashoffset: -40; }
        }
    </style>
</head>
<body>
    <div class="fold-line"></div>

    <a href="#controls" class="skip-link">Skip to main content</a>

    <nav class="nav-sidebar" aria-label="Document sections">
        <button class="nav-dot active" data-label="Overview" data-section="header" aria-label="Navigate to Overview" aria-current="true"></button>
        <button class="nav-dot" data-label="Parameters" data-section="controls" aria-label="Navigate to Parameters"></button>
        <button class="nav-dot" data-label="Transportation" data-section="transport" aria-label="Navigate to Transportation"></button>
        <button class="nav-dot" data-label="Real Estate" data-section="realestate" aria-label="Navigate to Real Estate"></button>
        <button class="nav-dot" data-label="Energy" data-section="energy" aria-label="Navigate to Energy"></button>
        <button class="nav-dot" data-label="Labor" data-section="labor" aria-label="Navigate to Labor"></button>
        <button class="nav-dot" data-label="Supply Chain" data-section="supply" aria-label="Navigate to Supply Chain"></button>
        <button class="nav-dot" data-label="Military" data-section="military" aria-label="Navigate to Military"></button>
        <button class="nav-dot" data-label="Space" data-section="space" aria-label="Navigate to Space"></button>
        <button class="nav-dot" data-label="Urban" data-section="urban" aria-label="Navigate to Urban"></button>
    </nav>

    <div class="document-container">
        <!-- Header -->
        <header class="document-header" id="header">
            <span class="stamp stamp-top-secret">Top Secret</span>
            <span class="stamp stamp-eyes-only">Eyes Only</span>
            <h1 class="document-title">The Economics of Antigravity</h1>
            <p class="document-subtitle">Global Economic Impact Assessment</p>
            <div class="document-meta">
                <span>REF: AG-ECON-2024-001</span>
                <span>STATUS: ACTIVE ANALYSIS</span>
                <span>CLEARANCE: LEVEL 5</span>
            </div>
        </header>

        <!-- Manila Folder Tabs -->
        <div class="folder-tabs" role="tablist" aria-label="Dossier tabs">
            <button class="folder-tab" id="tab-social" type="button" role="tab" aria-selected="false" aria-controls="panel-social" tabindex="-1" data-tab="social">Social</button>
            <button class="folder-tab active" id="tab-economic" type="button" role="tab" aria-selected="true" aria-controls="panel-economic" tabindex="0" data-tab="economic">Economic</button>
            <button class="folder-tab" id="tab-defense" type="button" role="tab" aria-selected="false" aria-controls="panel-defense" tabindex="-1" data-tab="defense">Defense</button>
        </div>

        <div class="main-layout">
            <!-- Timeline Sidebar -->
            <aside class="horizon-panel" aria-labelledby="horizon-title">
                <div class="horizon-scrubber" role="radiogroup" aria-label="Select projection year">
                    <button class="horizon-marker" type="button" role="radio" aria-checked="false" data-year="1" tabindex="-1">
                        <span class="horizon-marker-year">1</span>
                        <span class="horizon-marker-label">yr</span>
                    </button>
                    <button class="horizon-marker" type="button" role="radio" aria-checked="false" data-year="3" tabindex="-1">
                        <span class="horizon-marker-year">3</span>
                        <span class="horizon-marker-label">yrs</span>
                    </button>
                    <button class="horizon-marker" type="button" role="radio" aria-checked="false" data-year="5" tabindex="-1">
                        <span class="horizon-marker-year">5</span>
                        <span class="horizon-marker-label">yrs</span>
                    </button>
                    <button class="horizon-marker" type="button" role="radio" aria-checked="false" data-year="10" tabindex="-1">
                        <span class="horizon-marker-year">10</span>
                        <span class="horizon-marker-label">yrs</span>
                    </button>
                    <button class="horizon-marker" type="button" role="radio" aria-checked="false" data-year="25" tabindex="-1">
                        <span class="horizon-marker-year">25</span>
                        <span class="horizon-marker-label">yrs</span>
                    </button>
                    <button class="horizon-marker" type="button" role="radio" aria-checked="false" data-year="50" tabindex="-1">
                        <span class="horizon-marker-year">50</span>
                        <span class="horizon-marker-label">yrs</span>
                    </button>
                    <button class="horizon-marker" type="button" role="radio" aria-checked="false" data-year="100" tabindex="-1">
                        <span class="horizon-marker-year">100</span>
                        <span class="horizon-marker-label">yrs</span>
                    </button>
                </div>
            </aside>

            <main class="tab-content" id="tab-content">
            <section class="tab-panel" id="panel-social" role="tabpanel" aria-labelledby="tab-social" hidden>

                <!-- Year 1: The Containment Illusion -->
                <section class="section" data-section-num="S1" data-year="1" id="social-year1">
                    <div class="paper-clip"></div>
                    <div class="section-header">
                        <h2 class="section-title">Year 1: The Containment Illusion</h2>
                        <div class="section-status">
                            <span class="status-indicator mid" aria-hidden="true"></span>
                            <span>Containment Theater</span>
                        </div>
                    </div>

                    <div class="disruption-meter">
                        <div class="meter-header">
                            <span>Social Volatility Index</span>
                            <span>42%</span>
                        </div>
                        <div class="meter-track">
                            <div class="meter-fill" style="width: 42%"></div>
                        </div>
                        <div class="meter-labels">
                            <span>Friction</span>
                            <span>Break</span>
                            <span>Phase Change</span>
                        </div>
                    </div>

                    <p class="narrative">
                        The first viral video shows a teenager in Seoul floating above her apartment building, filming the sunrise.
                        Within 48 hours, governments worldwide announce "temporary flight restrictions" while frantically convening
                        emergency sessions. The technology spreads anyway, through <span class="redacted">encrypted channels</span>
                        and 3D-printed components, exactly as every revolutionary technology has before.
                    </p>
                    <div class="annotation" style="position: static; transform: rotate(-2deg); margin: 10px 0 6px;">
                        FIELD NOTE: you can regulate aircraft. You cannot regulate <span class="redacted">presence</span>.
                    </div>
                    <ul class="impact-list">
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>The Underground Float</strong>
                                <span>Early adopters form secretive communities, sharing coordinates for "safe zones" where government surveillance is thin. Night floating becomes a subculture, like early rave culture but vertical. Social media fills with blurry nighttime footage.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>The First Floating Protest</strong>
                                <span>Occupy veterans realize police kettling no longer works. A protest in Manila with 200 floaters hovering above a government building ends in chaos when authorities have no protocol for aerial civil disobedience.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>The Panic Move</strong>
                                <span>Wealthy families begin relocating to countries with weaker enforcement, creating the first "float havens." The Maldives declares itself <span class="redacted">open sky sovereign territory</span>.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>The Distance Death Begins</strong>
                                <span>Long-distance relationships see the first transformations. A couple separated by the Pacific realizes they can meet for lunch daily. Dating apps add "float-capable" as a filter.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Winners</strong>
                                <span>Early tech adopters, privacy advocates, people in long-distance relationships, isolated rural communities suddenly connected, mobility-impaired individuals who can now move freely in 3D space.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Losers</strong>
                                <span>Border patrol agencies, gated community security, helicopter tourism operators, anyone whose power derived from controlling movement.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Policy Failure: FAA "Experimental Aircraft"</strong>
                                <span>Requires certification. Fails because you cannot certify <span class="redacted">50 million</span> devices manufactured in garages.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Policy Failure: Jamming Fields</strong>
                                <span>China attempts jamming fields over major cities. Fails because the physics don't allow for it; creates massive black market for "jammer-immune" units.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Policy Failure: Mandatory Registration</strong>
                                <span>EU proposes registration and GPS tracking. Fails because unregistered units work identically to registered ones.</span>
                            </div>
                        </li>
                    </ul>
                </section>

                <!-- Year 3: The Great Unsticking -->
                <section class="section" data-section-num="S2" data-year="3" id="social-year3">
                    <div class="section-header">
                        <h2 class="section-title">Year 3: The Great Unsticking</h2>
                        <div class="section-status">
                            <span class="status-indicator high" aria-hidden="true"></span>
                            <span>Geography Unraveling</span>
                        </div>
                    </div>

                    <div class="disruption-meter">
                        <div class="meter-header">
                            <span>Social Volatility Index</span>
                            <span>61%</span>
                        </div>
                        <div class="meter-track">
                            <div class="meter-fill" style="width: 61%"></div>
                        </div>
                        <div class="meter-labels">
                            <span>Friction</span>
                            <span>Break</span>
                            <span>Phase Change</span>
                        </div>
                    </div>

                    <p class="narrative">
                        Real estate agents in Manhattan watch their listings rot as the commuter logic that built New York collapses
                        in real-time. A family in rural Montana now lives thirty minutes from Times Square, the Louvre, and their
                        grandmother in Osaka. The phrase "I live in..." becomes philosophically complicated.
                    </p>
                    <ul class="impact-list">
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Commuter Marriage Dies</strong>
                                <span>Couples maintaining separate residences for careers simply stop. A banker in London and filmmaker in LA share breakfast daily. Divorce rates for "distance-strained" marriages plummet 60%.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Grandparent Renaissance</strong>
                                <span>Grandparents become daily presences. A grandmother in Lagos helps raise her grandchildren in Toronto, present for school pickup every day.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Rural Healthcare Revolution</strong>
                                <span>Trauma surgeons arrive anywhere in minutes. Rural hospitals close—not from neglect, but because specialists now make house calls to mountain villages.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>University Scramble</strong>
                                <span>Harvard's value proposition collapses. Why pay for Cambridge housing when you can live in Bali and float to lecture? Applications for in-person programs fall 40%.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>The New Homelessness</strong>
                                <span>A disturbing pattern emerges—people living permanently aloft, floating between public spaces, never touching ground. Cities have no legal framework for "vertical vagrancy."</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Winners</strong>
                                <span>Rural property owners, multi-generational families, patients in medical deserts, relationships strained by distance, people escaping abusive situations who can now simply leave.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Losers</strong>
                                <span>Urban real estate holders, commuter rail systems, regional airlines, college town economies, anyone whose social power came from proximity gatekeeping.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Policy Failure: City "Float Zones"</strong>
                                <span>Major cities designate advisory altitudes for transit. Fails because enforcement requires resources that don't exist; becomes purely advisory.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Policy Failure: "Rooted" Tax Incentives</strong>
                                <span>Incentivize workers to maintain traditional commutes. Fails because employers quickly realize float-capable employees are more productive.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Policy Failure: University "Hybrid" Pivot</strong>
                                <span>Attempts at hybrid models fail because students correctly identify this as paying full tuition for Zoom calls.</span>
                            </div>
                        </li>
                    </ul>
                </section>

                <!-- Year 5: First Social Ruptures -->
                <section class="section" data-section-num="S3" data-year="5" id="social-year5">
                    <span class="stamp stamp-top-secret stamp-animate" style="--rotation: 10deg; top: 18px; right: 18px;">FILED</span>
                    <div class="section-header">
                        <h2 class="section-title">Year 5: The First Social Ruptures</h2>
                        <div class="section-status">
                            <span class="status-indicator high" aria-hidden="true"></span>
                            <span>Legal Systems Lagging</span>
                        </div>
                    </div>

                    <div class="disruption-meter">
                        <div class="meter-header">
                            <span>Social Volatility Index</span>
                            <span>74%</span>
                        </div>
                        <div class="meter-track">
                            <div class="meter-fill" style="width: 74%"></div>
                        </div>
                        <div class="meter-labels">
                            <span>Friction</span>
                            <span>Break</span>
                            <span>Phase Change</span>
                        </div>
                    </div>

                    <p class="narrative">
                        The skyline of every major city now includes a permanent floating population. Below, a man sues his neighbor
                        for "persistent aerial surveillance" after discovering drone footage of his backyard. The courts have no
                        precedent; privacy law assumed a <span class="redacted">2D world</span>.
                    </p>
                    <ul class="impact-list">
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Vertical Class War</strong>
                                <span>Floating becomes a class marker, but inverted. The wealthy cling to ground-level estates while the masses occupy the limitless sky. "Grounded" becomes slang for rich.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Death of Daily Commute</strong>
                                <span>Office work fragments entirely. Commercial real estate enters terminal decline. WeWork's successor provides "gathering coordinates."</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Tourism Inversion</strong>
                                <span>Paris doesn't empty—it transforms. 500,000 daily float-visitors. Parisians sell "authentic local experience" packages.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Border Fiction</strong>
                                <span>Immigration enforcement becomes theoretical. Some nations attempt vertical walls extending kilometers. They become tourist attractions.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Relationship Revolution</strong>
                                <span>Dating apps show "float radius"—not distance, but time. Everyone is fifteen minutes from everyone else. Hook-up culture accelerates, then so does long-term commitment: when you can meet anyone anywhere, choosing someone becomes meaningful.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Winners</strong>
                                <span>People in developing nations suddenly accessible to global opportunities, persecuted minorities who can flee, lovers separated by borders, anyone whose talent was trapped by geography.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Losers</strong>
                                <span>Border industrial complex, tourism-dependent economies that can't adapt, privacy-dependent lifestyles, xenophobes who assumed geography would maintain separation.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Policy Failure: "Citizenship Radius"</strong>
                                <span>Mandatory GPS tracking to define citizenship by time-spent. Fails because people game location data and enforcement is impossible.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Policy Failure: Total Float Management</strong>
                                <span>Air traffic control attempts comprehensive float management. Fails spectacularly during the Christmas rush when <span class="redacted">80 million</span> people try to visit family simultaneously.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Policy Failure: Privacy "Domes"</strong>
                                <span>Laws require visual barriers above private property. Fails when barriers become floating gardens, then habitats, then a new property class.</span>
                            </div>
                        </li>
                    </ul>
                </section>

                <!-- Year 10: New Geography -->
                <section class="section" data-section-num="S4" data-year="10" id="social-year10">
                    <div class="section-header">
                        <h2 class="section-title">Year 10: The New Geography of Human Life</h2>
                        <div class="section-status">
                            <span class="status-indicator high" aria-hidden="true"></span>
                            <span>Post-Commuter Society</span>
                        </div>
                    </div>

                    <div class="disruption-meter">
                        <div class="meter-header">
                            <span>Social Volatility Index</span>
                            <span>86%</span>
                        </div>
                        <div class="meter-track">
                            <div class="meter-fill" style="width: 86%"></div>
                        </div>
                        <div class="meter-labels">
                            <span>Friction</span>
                            <span>Break</span>
                            <span>Phase Change</span>
                        </div>
                    </div>

                    <p class="narrative">
                        The child born today will never understand why humans clustered in cities. She floats to school across
                        three time zones, her classroom a rotating assembly from every continent. Her best friend lives above
                        the Pacific. Her grandmother, orbiting at low altitude, waves as the girl passes beneath her
                        <span class="redacted">floating garden</span>.
                    </p>
                    <ul class="impact-list">
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Floating Communities</strong>
                                <span>Permanent aerial settlements—communities of thousands maintaining relative positions. Neo-Amsterdam hovers above the original, a mirror city in the sky.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Neo-Nomad Majority</strong>
                                <span>Percentage maintaining fixed residence drops below 40%. The concept of "hometown" survives only in the elderly.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Language Homogenization</strong>
                                <span>When every child has friends on every continent, linguistic isolation ends. A global pidgin emerges. The French Academy surrenders.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Healthcare Singularity</strong>
                                <span>Medical specialists become effectively omnipresent. A patient in rural Ghana receives the same quality of care as Manhattan. Geographic health inequity ends; new inequities emerge based on information access.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Death of Regional Culture</strong>
                                <span>Authentic local culture becomes impossible. "Regional" becomes a brand, a performance. Genuine culture—developed through isolation—ceases to exist.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Winners</strong>
                                <span>Children born into this world (no nostalgia for geographic constraints), global south populations accessing first-world opportunities, multilingual individuals, adaptable personalities.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Losers</strong>
                                <span>Place-based identities, traditional educational institutions, anyone whose expertise was "local knowledge," linguistic minorities, people who found meaning in geographic community.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Policy Failure: "Cultural Protection Zones"</strong>
                                <span>No-float areas meant to preserve authentic regional culture. Fails because young people simply leave; the zones become elderly enclaves.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Policy Failure: Universal Basic Coordinates</strong>
                                <span>Every human guaranteed a registered float-space. Fails because "property" in infinite sky becomes meaningless; the concept breaks down.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Policy: Global Coordination (Partial)</strong>
                                <span>Float-traffic coordination finally achieved, but only through radical decentralization; no single authority could manage the complexity.</span>
                            </div>
                        </li>
                    </ul>
                </section>

                <!-- Year 25: Distributed Society -->
                <section class="section" data-section-num="S5" data-year="25" id="social-year25">
                    <div class="section-header">
                        <h2 class="section-title">Year 25: The Social Structure Nobody Predicted</h2>
                        <div class="section-status">
                            <span class="status-indicator high" aria-hidden="true"></span>
                            <span>Constellation Norms</span>
                        </div>
                    </div>

                    <div class="disruption-meter">
                        <div class="meter-header">
                            <span>Social Volatility Index</span>
                            <span>93%</span>
                        </div>
                        <div class="meter-track">
                            <div class="meter-fill" style="width: 93%"></div>
                        </div>
                        <div class="meter-labels">
                            <span>Friction</span>
                            <span>Break</span>
                            <span>Phase Change</span>
                        </div>
                    </div>

                    <p class="narrative">
                        Marriage means something entirely different. The couple shares consciousness across planetary distances,
                        meeting physically three times daily across continents, their children raised by a network of seventeen
                        adults who consider themselves a single family unit. Asked where they "live," they look confused by the question.
                    </p>
                    <ul class="impact-list">
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Constellation Families</strong>
                                <span>Networks of 10-30 adults and children in continuous contact globally. Children have multiple "home bases." Geographic rootedness is quaint artifact.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>University Death</strong>
                                <span>Physical universities exist only as monuments. Education is mentorship-based, students floating to experts worldwide. Harvard persists only as certification service.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Work as Pure Collaboration</strong>
                                <span>The concept of "workplace" becomes archaeologically interesting. Teams assemble physically for creative work, then disperse globally. "Colleagues" are people you've physically met perhaps three times. It works better than permanent co-location ever did.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>New Religion</strong>
                                <span>Pilgrimage transforms from journey to instant arrival. Mecca sees 50 million visitors during Hajj—daily, not annually. New faiths emerge for float-specific practices.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Crime and Policing in 3D Space</strong>
                                <span>Traditional law enforcement collapses entirely. New systems emerge based on social credit, community enforcement, and the impossibility of hiding. Privacy is dead, but so is anonymized crime. A strange equilibrium emerges: total surveillance enables total accountability.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Winners</strong>
                                <span>Humans who thrive on novelty and connection, children who never knew limitations, creative collaborators, distributed families, spiritual seekers.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Losers</strong>
                                <span>Introverts who relied on geographic barriers, criminals who depended on anonymity, institutions whose power derived from physical gatekeeping, anyone nostalgic for the old world.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Policy: Global Governance (Finally)</strong>
                                <span>Attempts succeed only because national boundaries become fictional. The <span class="redacted">United Regions</span> replaces the UN, organized by interest rather than geography.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Policy: Privacy as Paid Service</strong>
                                <span>Electromagnetic shields that guarantee solitude become the new luxury good.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Policy: Universal Translation</strong>
                                <span>Language barriers become moot. Homogenization accelerates; distinct cultures become performance art.</span>
                            </div>
                        </li>
                    </ul>
                </section>

                <!-- Year 50: Unrecognizable Present -->
                <section class="section" data-section-num="S6" data-year="50" id="social-year50">
                    <div class="section-header">
                        <h2 class="section-title">Year 50: The Unrecognizable Present</h2>
                        <div class="section-status">
                            <span class="status-indicator high" aria-hidden="true"></span>
                            <span>Post-National Humanity</span>
                        </div>
                    </div>

                    <div class="disruption-meter">
                        <div class="meter-header">
                            <span>Social Volatility Index</span>
                            <span>97%</span>
                        </div>
                        <div class="meter-track">
                            <div class="meter-fill" style="width: 97%"></div>
                        </div>
                        <div class="meter-labels">
                            <span>Friction</span>
                            <span>Break</span>
                            <span>Phase Change</span>
                        </div>
                    </div>

                    <p class="narrative">
                        The historian explains "immigration" to her students. They cannot grasp it. The idea that humans were sorted
                        by birthplace, that invisible lines determined life outcomes—it sounds like a <span class="redacted">fairy tale</span>,
                        something from the age of kings and serfs. The students float back to their various continents, promising to
                        reconvene tomorrow above the Pacific.
                    </p>
                    <ul class="impact-list">
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Physical Gathering as Ritual</strong>
                                <span>Meeting in person becomes sacred. "Convergence days" for weddings, births, deaths. Physical co-location is ceremony, not default.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>The Great Mixing</strong>
                                <span>Four generations of global mobility homogenize genetics. "Race" survives only in historical texts. Everyone is some version of brown.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Orbital Suburbs</strong>
                                <span>Low Earth orbit communities house 100 million. They develop distinct customs, slang, physical adaptations. First orbital-born generation reaches adulthood.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>The Memory of Place</strong>
                                <span>Nostalgia for geographic rootedness becomes an entire cultural movement. "Rooters" voluntarily restrict their movement, living in single locations for years—romantic or mentally ill, depending on perspective.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Democracy Without Borders</strong>
                                <span>Political participation decouples from geography. Vote for interest-community representatives, not location. Constituencies become ideological.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Winners</strong>
                                <span>Humanity as a species (genetic diversity increases resilience), space-adapted humans, interest-based communities, creative types who thrive on constant stimulation.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Losers</strong>
                                <span>Historical preservationists, traditionalists of all stripes, anyone who found meaning in place-based identity, introverts who can no longer find genuine solitude.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Policy: "Heritage Zones"</strong>
                                <span>Protect remaining traditional communities. Partial success—they become living museums, subsidized for cultural preservation value.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Policy: Orbital Governance</strong>
                                <span>Orbital governance emerges as genuinely distinct jurisdiction. Success—the first true post-national political entities.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Policy Failure: "Heritage Matching"</strong>
                                <span>Attempts to limit genetic homogenization fail completely—young people find the concept offensive.</span>
                            </div>
                        </li>
                    </ul>
                </section>

                <!-- Year 100: Speculation -->
                <section class="section" data-section-num="S7" data-year="100" id="social-year100">
                    <div class="section-header">
                        <h2 class="section-title">Year 100: Speculation Territory</h2>
                        <div class="section-status">
                            <span class="status-indicator high" aria-hidden="true"></span>
                            <span>Beyond Recognition</span>
                        </div>
                    </div>

                    <div class="disruption-meter">
                        <div class="meter-header">
                            <span>Social Volatility Index</span>
                            <span>99%</span>
                        </div>
                        <div class="meter-track">
                            <div class="meter-fill" style="width: 99%"></div>
                        </div>
                        <div class="meter-labels">
                            <span>Friction</span>
                            <span>Break</span>
                            <span>Phase Change</span>
                        </div>
                    </div>

                    <p class="narrative">
                        The being who was once called human floats between Venus and Mars, consciousness distributed across seventeen
                        bodies, some biological, some synthetic. She remembers—or thinks she remembers—a time when people were
                        trapped on a single rock, unable to move except by <span class="redacted">crawling along its surface</span>.
                        It seems impossibly primitive.
                    </p>
                    <ul class="impact-list">
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Solar Diaspora</strong>
                                <span>Humanity on every viable body. Mars has 5M+ population. Travel time measured in hours. Distinct cultures develop—by ideology, not isolation.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Identity Beyond Body</strong>
                                <span>Physical embodiment optional. Consciousness transmitted, backed up, distributed. "Family" means networks of minds merged and recombined across a century.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Death of Scarcity Psychology</strong>
                                <span>Go anywhere, obtain anything, meet anyone. New meaning systems focused on creation, experience, and attention—the only remaining scarcity.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Distance Rediscovered</strong>
                                <span>First interstellar colonists depart knowing they'll be separated by decades of lag. Voluntary limitation as spiritual practice.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>The Question of Humanity</strong>
                                <span>What remains of "human society" when bodies are optional, location is arbitrary, and consciousness can be copied? The concept becomes archaeologically interesting—something else has emerged, continuous with humanity but transformed beyond recognition.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Winners</strong>
                                <span>Post-human entities, consciousness-explorers, meaning-makers, those who embrace transformation.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Losers</strong>
                                <span>The concept of "winning and losing" has become incoherent when applied to beings this transformed.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Policy Response</strong>
                                <span>Policy itself becomes antiquated. Coordination happens through distributed consensus protocols, evolutionary selection among competing governance experiments, and the accumulated wisdom of civilizations that survived their own technological adolescence.</span>
                            </div>
                        </li>
                    </ul>
                </section>

            </section>

            <section class="tab-panel" id="panel-economic" role="tabpanel" aria-labelledby="tab-economic">
                <!-- Control Panel -->
                <details class="control-panel" id="controls" open>
                    <summary class="control-summary">
                        <div class="control-header">
                            <h2>Scenario Parameters</h2>
                        </div>
                    </summary>
                    <div class="control-body">
                        <div class="control-grid" role="group" aria-label="Scenario parameters">
                            <div class="control-row">
                                <label class="control-label" for="adoption-rate">Adoption Timeline</label>
                                <div class="control-slider">
                                    <input type="range" id="adoption-rate" min="1" max="100" value="20" aria-describedby="adoption-value">
                                </div>
                                <span class="control-value" id="adoption-value" aria-live="polite">20 years</span>
                            </div>
                            <div class="control-row">
                                <label class="control-label" for="energy-cost">Energy Requirement</label>
                                <div class="control-slider">
                                    <input type="range" id="energy-cost" min="0" max="100" value="50" aria-describedby="energy-value">
                                </div>
                                <span class="control-value" id="energy-value" aria-live="polite">Moderate</span>
                            </div>
                            <div class="control-row">
                                <label class="control-label" for="payload">Payload Capacity</label>
                                <div class="control-slider">
                                    <input type="range" id="payload" min="0" max="100" value="60" aria-describedby="payload-value">
                                </div>
                                <span class="control-value" id="payload-value" aria-live="polite">Industrial</span>
                            </div>
                            <div class="control-row">
                                <label class="control-label" for="regulation">Regulatory Response</label>
                                <div class="control-slider">
                                    <input type="range" id="regulation" min="0" max="100" value="50" aria-describedby="regulation-value">
                                </div>
                                <span class="control-value" id="regulation-value" aria-live="polite">Controlled</span>
                            </div>
                            <div class="control-row">
                                <label class="control-label" for="discovery-context">Discovery Context</label>
                                <div class="control-select">
                                    <select id="discovery-context">
                                        <option value="government">Government Lab</option>
                                        <option value="corporation" selected>Corporation</option>
                                        <option value="individual">Independent</option>
                                        <option value="accident">Accident</option>
                                    </select>
                                </div>
                                <span class="control-value"></span>
                            </div>
                        </div>
                        <button class="recalculate-btn" id="recalculate">Recalculate Projections</button>
                    </div>
                </details>

        <!-- Economic Flow Sankey -->
        <section class="sankey-container" aria-labelledby="sankey-title">
            <h3 id="sankey-title" class="visually-hidden">Economic Flow Analysis</h3>
            <div class="sankey-header">
                <span>Pre-Antigravity</span>
                <span>Post-Antigravity</span>
            </div>
            <svg id="sankey-diagram" viewBox="0 0 800 400" role="img" aria-label="Sankey diagram showing economic flow changes from pre-antigravity to post-antigravity sectors"></svg>
        </section>

        <!-- Job Counter Summary -->
        <div class="job-counter">
            <div class="counter-box">
                <div class="counter-label">Jobs Eliminated</div>
                <div class="counter-value negative" id="jobs-lost">-47.2M</div>
                <div class="counter-unit">globally</div>
            </div>
            <div class="counter-box">
                <div class="counter-label">Jobs Created</div>
                <div class="counter-value positive" id="jobs-gained">+18.6M</div>
                <div class="counter-unit">new sectors</div>
            </div>
            <div class="counter-box">
                <div class="counter-label">Net Impact</div>
                <div class="counter-value neutral" id="jobs-net">-28.6M</div>
                <div class="counter-unit">transition period</div>
            </div>
        </div>

        <!-- Geographic Diffusion Map -->
        <section class="map-container" aria-labelledby="map-title">
            <h3 id="map-title" class="visually-hidden">Global Adoption and Regional Economic Impact</h3>
            <div class="map-header">
                <span>GLOBAL ADOPTION</span>
                <span>REGIONAL SHOCK INTENSITY</span>
            </div>
            <div class="map-grid">
                <div class="map-canvas-wrap">
                    <canvas id="world-map" width="800" height="420" role="img" aria-label="World map showing regional adoption rates and economic impact"></canvas>
                    <div class="map-caption" id="map-caption">Adoption fills; impact hatching. Values update with timeline year.</div>
                </div>
                <div class="map-legend" aria-label="Map legend and regional readout">
                    <div class="legend-block">
                        <div class="legend-title">Adoption</div>
                        <div class="legend-bar legend-adoption" aria-hidden="true"></div>
                        <div class="legend-labels">
                            <span>0%</span><span>100%</span>
                        </div>
                    </div>
                    <div class="legend-block">
                        <div class="legend-title">Impact</div>
                        <div class="legend-hatch" aria-hidden="true"></div>
                        <div class="legend-labels">
                            <span>Low</span><span>High</span>
                        </div>
                    </div>
                    <div class="region-readout" id="region-readout" aria-live="polite"></div>
                </div>
            </div>
        </section>

        <!-- Historical Analogues -->
        <section class="analogues-container" aria-labelledby="analogues-title">
            <h3 class="analogues-header" id="analogues-title">Historical Analogues</h3>
            <p class="analogues-subtitle">
                Two technologies with non-linear diffusion curves. Use as a reference frame for how quickly infrastructure can reorganize once a tipping point is reached.
            </p>
            <div class="sparkline-grid" role="group" aria-label="Sparkline charts of historical adoption curves">
                <div class="sparkline-card">
                    <div class="sparkline-meta">
                        <div class="sparkline-title">Containerization</div>
                        <div class="sparkline-range">1956 → 1980</div>
                    </div>
                    <canvas class="sparkline" id="spark-containerization" width="420" height="90" aria-label="Sparkline chart showing containerization adoption curve"></canvas>
                </div>
                <div class="sparkline-card">
                    <div class="sparkline-meta">
                        <div class="sparkline-title">Internet</div>
                        <div class="sparkline-range">1990 → 2010</div>
                    </div>
                    <canvas class="sparkline" id="spark-internet" width="420" height="90" aria-label="Sparkline chart showing internet adoption curve"></canvas>
                </div>
            </div>
        </section>

        <!-- Section 1: Transportation -->
        <section class="section" data-section-num="01" id="transport">
            <div class="section-header">
                <h2 class="section-title">Transportation</h2>
                <div class="section-status">
                    <span class="status-indicator high" aria-hidden="true"></span>
                    <span>Catastrophic Disruption</span>
                </div>
            </div>

            <div class="disruption-meter">
                <div class="meter-header">
                    <span>Sector Disruption Level</span>
                    <span id="transport-pct">94%</span>
                </div>
                <div class="meter-track">
                    <div class="meter-fill" id="transport-meter" style="width: 94%"></div>
                </div>
                <div class="meter-labels">
                    <span>Adaptation</span>
                    <span>Restructuring</span>
                    <span>Collapse</span>
                </div>
            </div>

            <p class="narrative" id="transport-narrative">
                At current parameters, the first commercial antigravity cargo platform enters service within <span class="redacted">five years</span>.
                By year fifteen, traditional shipping routes become archaeological curiosities. The Port of Shanghai
                transforms into the world's largest floating logistics hub, processing cargo that never touches water.
            </p>

            <ul class="impact-list">
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Maritime Shipping: $14.1T Industry Collapse</strong>
                        <span>Container ships become scrap metal. Fuel costs: irrelevant. Port infrastructure: stranded assets.</span>
                    </div>
                </li>
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Trucking: 3.5M US Jobs Eliminated</strong>
                        <span>Long-haul trucking disappears. Last-mile delivery transforms into aerial drop zones.</span>
                    </div>
                </li>
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Commercial Aviation: Route Networks Obsolete</strong>
                        <span>Airports become redundant. Point-to-point travel at any scale, any distance.</span>
                    </div>
                </li>
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Rail Freight: Niche Survival Only</strong>
                        <span>Bulk commodities may justify fixed routes. Everything else goes airborne.</span>
                    </div>
                </li>
            </ul>
        </section>

        <!-- Section 2: Real Estate -->
        <section class="section" data-section-num="02" id="realestate">
            <div class="paper-clip"></div>
            <div class="section-header">
                <h2 class="section-title">Real Estate</h2>
                <div class="section-status">
                    <span class="status-indicator high" aria-hidden="true"></span>
                    <span>Fundamental Restructuring</span>
                </div>
            </div>

            <div class="disruption-meter">
                <div class="meter-header">
                    <span>Sector Disruption Level</span>
                    <span id="realestate-pct">87%</span>
                </div>
                <div class="meter-track">
                    <div class="meter-fill" id="realestate-meter" style="width: 87%"></div>
                </div>
                <div class="meter-labels">
                    <span>Adaptation</span>
                    <span>Restructuring</span>
                    <span>Collapse</span>
                </div>
            </div>

            <p class="narrative" id="realestate-narrative">
                The fundamental premise of real estate—location, location, location—dissolves overnight. Manhattan
                square footage trades at parity with Kansas farmland. The only remaining premium: views and neighbors.
            </p>

            <ul class="impact-list">
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Location Premium: Eliminated</strong>
                        <span>Commute time becomes universal. Proximity to anything stops mattering.</span>
                    </div>
                </li>
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Vertical Expansion: Unlimited</strong>
                        <span>Buildings float. Stack infinitely. Ground connection becomes optional.</span>
                    </div>
                </li>
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Commercial Property: Mass Obsolescence</strong>
                        <span>Warehouses, ports, airports—billions in stranded assets.</span>
                    </div>
                </li>
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Rural Land: Appreciation</strong>
                        <span>Space becomes the only constraint. Remote locations gain equivalence.</span>
                    </div>
                </li>
            </ul>
        </section>

        <!-- Section 3: Energy -->
        <section class="section" data-section-num="03" id="energy">
            <div class="section-header">
                <h2 class="section-title">Energy Sector</h2>
                <div class="section-status">
                    <span class="status-indicator mid" aria-hidden="true"></span>
                    <span>Depends on Physics</span>
                </div>
            </div>

            <div class="disruption-meter">
                <div class="meter-header">
                    <span>Sector Disruption Level</span>
                    <span id="energy-pct">62%</span>
                </div>
                <div class="meter-track">
                    <div class="meter-fill" id="energy-meter" style="width: 62%"></div>
                </div>
                <div class="meter-labels">
                    <span>Adaptation</span>
                    <span>Restructuring</span>
                    <span>Collapse</span>
                </div>
            </div>

            <p class="narrative" id="energy-narrative">
                The energy implications depend entirely on what antigravity <em>costs</em> to run. At current parameter settings,
                antigravity requires moderate energy input—enough to disrupt transportation fuels while preserving
                the broader energy infrastructure.
            </p>

            <ul class="impact-list">
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>If Energy-Intensive: Oil Gets a Reprieve</strong>
                        <span>Massive electricity demand. Nuclear becomes critical. Grid expansion urgent.</span>
                    </div>
                </li>
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>If Energy-Neutral: Transportation Fuels Collapse</strong>
                        <span>Gasoline, diesel, jet fuel demand craters. Refineries close.</span>
                    </div>
                </li>
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>If Net-Positive: <span class="redacted">Post-Scarcity</span></strong>
                        <span>Physics breaks. Infinite energy. Economic models become meaningless.</span>
                    </div>
                </li>
            </ul>
        </section>

        <!-- Section 4: Labor Markets -->
        <section class="section" data-section-num="04" id="labor">
            <div class="section-header">
                <h2 class="section-title">Labor Markets</h2>
                <div class="section-status">
                    <span class="status-indicator high" aria-hidden="true"></span>
                    <span>Mass Displacement</span>
                </div>
            </div>

            <div class="disruption-meter">
                <div class="meter-header">
                    <span>Sector Disruption Level</span>
                    <span id="labor-pct">78%</span>
                </div>
                <div class="meter-track">
                    <div class="meter-fill" id="labor-meter" style="width: 78%"></div>
                </div>
                <div class="meter-labels">
                    <span>Adaptation</span>
                    <span>Restructuring</span>
                    <span>Collapse</span>
                </div>
            </div>

            <p class="narrative" id="labor-narrative">
                Fifty million transport workers globally face obsolescence. The cascade extends through logistics,
                warehousing, fuel stations, roadside services. New jobs emerge in antigravity maintenance, vertical
                construction, and space operations—but the transition period is brutal.
            </p>

            <ul class="impact-list">
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Direct Job Loss: ~50M Transport Workers</strong>
                        <span>Truck drivers, pilots, sailors, rail workers—entire professions vanish.</span>
                    </div>
                </li>
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Indirect Cascade: Multiplied Impact</strong>
                        <span>Logistics, warehousing, fuel stations, motels, truck stops, repair shops.</span>
                    </div>
                </li>
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>New Sectors: Partial Offset</strong>
                        <span>Antigravity techs, vertical architects, space operations, aerial traffic control.</span>
                    </div>
                </li>
            </ul>

            <div class="job-counter" style="margin-top: 20px;">
                <div class="counter-box">
                    <div class="counter-label">Transport</div>
                    <div class="counter-value negative">-12.4M</div>
                </div>
                <div class="counter-box">
                    <div class="counter-label">Logistics</div>
                    <div class="counter-value negative">-8.7M</div>
                </div>
                <div class="counter-box">
                    <div class="counter-label">Services</div>
                    <div class="counter-value negative">-6.2M</div>
                </div>
            </div>
        </section>

        <!-- Section 5: Supply Chains -->
        <section class="section" data-section-num="05" id="supply">
            <div class="section-header">
                <h2 class="section-title">Supply Chains</h2>
                <div class="section-status">
                    <span class="status-indicator high" aria-hidden="true"></span>
                    <span>Singularity</span>
                </div>
            </div>

            <div class="disruption-meter">
                <div class="meter-header">
                    <span>Sector Disruption Level</span>
                    <span id="supply-pct">91%</span>
                </div>
                <div class="meter-track">
                    <div class="meter-fill" id="supply-meter" style="width: 91%"></div>
                </div>
                <div class="meter-labels">
                    <span>Adaptation</span>
                    <span>Restructuring</span>
                    <span>Collapse</span>
                </div>
            </div>

            <p class="narrative" id="supply-narrative">
                Just-in-time manufacturing reaches its logical conclusion: minutes from factory to consumer.
                Why maintain inventory when replenishment is instant? Why build warehouses when the sky is the warehouse?
            </p>

            <ul class="impact-list">
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Inventory: Near Zero</strong>
                        <span>Storage becomes obsolete. Goods move continuously from production to consumption.</span>
                    </div>
                </li>
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Globalization: Complete</strong>
                        <span>Distance friction eliminated. Manufacturing location becomes arbitrary.</span>
                    </div>
                </li>
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Labor Arbitrage: The Only Factor</strong>
                        <span>With transport costs at zero, wage differentials drive all location decisions.</span>
                    </div>
                </li>
            </ul>
        </section>

        <!-- Section 6: Military -->
        <section class="section" data-section-num="06" id="military">
            <div class="paper-clip"></div>
            <div class="section-header">
                <h2 class="section-title">Military & Defense</h2>
                <div class="section-status">
                    <span class="status-indicator high" aria-hidden="true"></span>
                    <span>Power Projection Transformed</span>
                </div>
            </div>

            <div class="disruption-meter">
                <div class="meter-header">
                    <span>Sector Disruption Level</span>
                    <span id="military-pct">89%</span>
                </div>
                <div class="meter-track">
                    <div class="meter-fill" id="military-meter" style="width: 89%"></div>
                </div>
                <div class="meter-labels">
                    <span>Adaptation</span>
                    <span>Restructuring</span>
                    <span>Collapse</span>
                </div>
            </div>

            <p class="narrative" id="military-narrative">
                Aircraft carriers become the most expensive targets in history. Fortifications cease to exist.
                Every nation with antigravity can project power anywhere, instantly. The calculus of defense
                inverts entirely.
            </p>

            <ul class="impact-list">
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Naval Supremacy: Ended</strong>
                        <span>Surface ships become sitting ducks. Submarines gain relative advantage.</span>
                    </div>
                </li>
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Air Superiority: Redefined</strong>
                        <span>3D movement without runways. Combat becomes truly three-dimensional.</span>
                    </div>
                </li>
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Fortification: Impossible</strong>
                        <span>Walls, bunkers, terrain—all irrelevant when attackers float overhead.</span>
                    </div>
                </li>
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Space Militarization: Accelerated</strong>
                        <span>Orbital platforms become trivial to construct. High ground redefined.</span>
                    </div>
                </li>
            </ul>
        </section>

        <!-- Section 7: Space Access -->
        <section class="section" data-section-num="07" id="space">
            <div class="section-header">
                <h2 class="section-title">Space Access</h2>
                <div class="section-status">
                    <span class="status-indicator high" aria-hidden="true"></span>
                    <span>The Door Opens</span>
                </div>
            </div>

            <div class="disruption-meter">
                <div class="meter-header">
                    <span>Sector Disruption Level</span>
                    <span id="space-pct">96%</span>
                </div>
                <div class="meter-track">
                    <div class="meter-fill" id="space-meter" style="width: 96%"></div>
                </div>
                <div class="meter-labels">
                    <span>Adaptation</span>
                    <span>Restructuring</span>
                    <span>Collapse</span>
                </div>
            </div>

            <p class="narrative" id="space-narrative">
                Launch costs drop from $2,720/kg to effectively zero. The rocket equation becomes a historical
                footnote. Orbital infrastructure explodes. The Moon becomes a weekend destination. Mars colonization
                shifts from decades to years.
            </p>

            <ul class="impact-list">
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Launch Costs: Collapse</strong>
                        <span>No rockets. No fuel. No expendable hardware. Just lift.</span>
                    </div>
                </li>
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Orbital Infrastructure: Explosion</strong>
                        <span>Stations, habitats, manufacturing platforms—mass construction begins.</span>
                    </div>
                </li>
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Asteroid Mining: Viable</strong>
                        <span>Transport cost was the only blocker. Rare earth abundance transforms.</span>
                    </div>
                </li>
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Colonization: Accelerated</strong>
                        <span>Moon bases, Mars settlements—the timeline compresses from decades to years.</span>
                    </div>
                </li>
            </ul>
        </section>

        <!-- Section 8: Urban Planning -->
        <section class="section" data-section-num="08" id="urban">
            <div class="section-header">
                <h2 class="section-title">Urban Planning</h2>
                <div class="section-status">
                    <span class="status-indicator mid" aria-hidden="true"></span>
                    <span>Cities Transform</span>
                </div>
            </div>

            <div class="disruption-meter">
                <div class="meter-header">
                    <span>Sector Disruption Level</span>
                    <span id="urban-pct">73%</span>
                </div>
                <div class="meter-track">
                    <div class="meter-fill" id="urban-meter" style="width: 73%"></div>
                </div>
                <div class="meter-labels">
                    <span>Adaptation</span>
                    <span>Restructuring</span>
                    <span>Collapse</span>
                </div>
            </div>

            <p class="narrative" id="urban-narrative">
                Paradoxically, the end of commuting reverses suburban sprawl. When you can live anywhere, density
                becomes a choice rather than a necessity. Cities transform from transportation hubs into cultural
                centers. Roads become parks.
            </p>

            <ul class="impact-list">
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Sprawl: Reverses</strong>
                        <span>No commute means density becomes preference-driven, not necessity.</span>
                    </div>
                </li>
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Floating Structures: Commonplace</strong>
                        <span>Parks above cities. Residential platforms. 3D urban grids emerge.</span>
                    </div>
                </li>
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Roads: Obsolete</strong>
                        <span>Ground-level transportation infrastructure repurposed or demolished.</span>
                    </div>
                </li>
                <li class="impact-item">
                    <div class="impact-marker"></div>
                    <div class="impact-text">
                        <strong>Megastructures: Possible</strong>
                        <span>Arcologies, orbital rings, floating cities—engineering limits redefined.</span>
                    </div>
                </li>
            </ul>
        </section>

        <!-- Timeline Section -->
        <section class="timeline-container" aria-labelledby="timeline-title">
            <h3 class="timeline-header" id="timeline-title">Cascade Timeline</h3>
            <div class="timeline-viz">
                <svg id="cascade-timeline" viewBox="0 0 800 240" role="img" aria-label="Timeline showing cascading effects across technology, markets, infrastructure, society, geopolitics, and space from Year 0 to Year 100"></svg>
                <div class="timeline-notes" id="timeline-notes" aria-live="polite"></div>
            </div>
            <p class="narrative" style="margin-top: 18px;">
                Timeline display references the active scrubber setting (Year <span class="js-current-year">10</span>).
            </p>
        </section>

        <!-- Footer -->
        <footer class="document-footer">
            <div class="footer-stamp">End of Document</div>
            <p class="footer-text">
                This document contains speculative economic analysis based on theoretical physics.<br>
                All projections assume successful implementation of antigravity technology.<br>
                Actual outcomes may vary based on <span class="redacted">classified variables</span>.
            </p>
        </footer>

            </section>

            <section class="tab-panel" id="panel-defense" role="tabpanel" aria-labelledby="tab-defense" hidden>

                <!-- Year 1: Discovery Shock -->
                <section class="section" data-section-num="D1" data-year="1" id="defense-year1">
                    <span class="stamp stamp-eyes-only stamp-animate" style="--rotation: -6deg; top: 18px; right: 18px; bottom: auto; left: auto;">SIMULATION</span>
                    <div class="section-header">
                        <h2 class="section-title">Year 1: Discovery Shock</h2>
                        <div class="section-status">
                            <span class="status-indicator high" aria-hidden="true"></span>
                            <span>Assumptions Collapsing</span>
                        </div>
                    </div>

                    <div class="disruption-meter">
                        <div class="meter-header">
                            <span>Strategic Instability Index</span>
                            <span>67%</span>
                        </div>
                        <div class="meter-track">
                            <div class="meter-fill" style="width: 67%"></div>
                        </div>
                        <div class="meter-labels">
                            <span>Contested</span>
                            <span>Uncertain</span>
                            <span>Obsolete</span>
                        </div>
                    </div>

                    <p class="narrative" style="font-style: normal; border-left-color: var(--stamp-red);">
                        "Gentlemen, we have confirmation. The physics is real. Within 18 months, every assumption underlying our
                        force structure, our treaties, our entire concept of defensible borders—all of it becomes obsolete.
                        The question isn't whether this leaks. It's whether we're <span class="redacted">ahead or behind</span> when it does."
                        <br><em>— Simulated NSC Principal's Committee, Day 14</em>
                    </p>
                    <ul class="impact-list">
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Classification Panic</strong>
                                <span>Discovery triggers immediate SIGMA-level compartmentalization regardless of origin. Manhattan Project 2.0 activated within 72 hours. Historical precedent: nuclear secrets reached the USSR in 4 years. AG physics cannot be unlearned. Clock starts now.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Intelligence Chaos</strong>
                                <span>Every major service audits physics programs, floods academia with talent spotters, initiates crash replication, and tries to assess competitors' progress (impossible—no indicators yet). Paranoia hits Cold War peaks.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Immediate Military Assessment</strong>
                                <span>Initial wargames are catastrophic: carrier strike groups shift from "contested" to "indefensible"; borders become "unenforceable against peer AG capability"; strategic depth is negated—<span class="redacted">all territory becomes frontier</span>. Classified recommendation: accelerate submarine fleet expansion. Only platform that can still hide.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Diplomatic Scramble</strong>
                                <span>Backchannels activate across major powers. Everyone lies about progress. Trust collapses further. Existing arms control frameworks (New START, Open Skies remnants) become irrelevant—no inspection regime covers this.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Gaining Advantage</strong>
                                <span>Nations with advanced physics research bases (US, China, Russia, EU, Japan, Israel), submarine-focused navies, landlocked nations (geographic disadvantage erased), intelligence services (budget explosion).</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Losing Advantage</strong>
                                <span>Island fortress nations (UK, Japan, Australia), chokepoint controllers (Egypt, Panama, Singapore, Turkey), nations reliant on geographic barriers, surface naval powers (doctrine obsolete).</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Containment Failure: Academic Suppression</strong>
                                <span>Pre-print servers scrubbed, researchers approached. Three leak anyway within 8 months. You cannot classify physics.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Containment Failure: Patent Denial</strong>
                                <span>Corporate applicants denied on national security grounds. They publish theory out of spite. Knowledge spreads.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Containment Failure: International Agreement</strong>
                                <span>Emergency UN Security Council session. China and Russia agree to "joint oversight." Neither means it. Neither believes the other.</span>
                            </div>
                        </li>
                    </ul>
                </section>

                <!-- Year 3: Proliferation Begins -->
                <section class="section" data-section-num="D2" data-year="3" id="defense-year3">
                    <div class="section-header">
                        <h2 class="section-title">Year 3: Proliferation Begins</h2>
                        <div class="section-status">
                            <span class="status-indicator high" aria-hidden="true"></span>
                            <span>Containment Failing</span>
                        </div>
                    </div>

                    <div class="disruption-meter">
                        <div class="meter-header">
                            <span>Strategic Instability Index</span>
                            <span>79%</span>
                        </div>
                        <div class="meter-track">
                            <div class="meter-fill" style="width: 79%"></div>
                        </div>
                        <div class="meter-labels">
                            <span>Contested</span>
                            <span>Uncertain</span>
                            <span>Obsolete</span>
                        </div>
                    </div>

                    <p class="narrative" style="font-style: normal; border-left-color: var(--stamp-red);">
                        "We've confirmed AG capability in seven nations. Suspected in twelve more. At least three non-state actors
                        have working prototypes—two corporate, one <span class="redacted">unknown</span>. The genie isn't just out of the bottle.
                        The bottle is shattered."
                        <br><em>— Simulated DIA Assessment, Month 31</em>
                    </p>
                    <ul class="impact-list">
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>First Military Prototypes</strong>
                                <span>Low payload, limited range, massive energy signatures. But immune to ALL existing air defense doctrine. Every SAM system becomes expensive lawn decoration.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Carrier Crisis</strong>
                                <span>US Navy classified exercise simulates AG attack on carrier strike group. Results redacted. CNO requests emergency SECDEF meeting. Carrier construction "paused."</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Border Collapse Preview</strong>
                                <span>First smuggling incidents via improvised AG. Crude, dangerous, effective. Every border agency realizes: walls are now decorative.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Submarine Premium</strong>
                                <span>Submarines become the only platform that can hide, survive first strike, preserve second-strike capability, and project power without immediate destruction. Every major power begins emergency submarine expansion.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Nuclear Calculus Shift</strong>
                                <span>ICBMs become redundant—AG platforms deliver from any vector. Detection nearly impossible. No rocket plume. No ballistic arc. Nuclear terrorism barrier drops catastrophically.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Gaining Advantage</strong>
                                <span>Nations with submarine industrial bases (US, Russia, China, France, UK), physics talent magnets, compact/mobile doctrines (Israel, smaller NATO members), organizations able to transform fast.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Losing Advantage</strong>
                                <span>Large surface navies, border-dependent economies (chokepoint premium evaporates), nations with expensive fixed defenses, nuclear states relying on detection for deterrence.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Containment Failure: Export Controls</strong>
                                <span>ITAR expanded to cover AG. Components too simple and physics too basic. Iran has a working prototype by Month 24.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Containment Failure: Corporate Containment</strong>
                                <span>Three companies "voluntarily" nationalized. Two others move headquarters to Switzerland and continue development.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Containment Failure: AG Non-Proliferation Treaty</strong>
                                <span>Proposed treaty collapses fast. China walks out. Russia signs and violates immediately. Dead in 8 months.</span>
                            </div>
                        </li>
                    </ul>
                </section>

                <!-- Year 5: Operational Deployments -->
                <section class="section" data-section-num="D3" data-year="5" id="defense-year5">
                    <div class="section-header">
                        <h2 class="section-title">Year 5: First Operational Deployments</h2>
                        <div class="section-status">
                            <span class="status-indicator high" aria-hidden="true"></span>
                            <span>Doctrine Obsolescence</span>
                        </div>
                    </div>

                    <div class="disruption-meter">
                        <div class="meter-header">
                            <span>Strategic Instability Index</span>
                            <span>88%</span>
                        </div>
                        <div class="meter-track">
                            <div class="meter-fill" style="width: 88%"></div>
                        </div>
                        <div class="meter-labels">
                            <span>Contested</span>
                            <span>Uncertain</span>
                            <span>Obsolete</span>
                        </div>
                    </div>

                    <p class="narrative" style="font-style: normal; border-left-color: var(--stamp-red);">
                        "PACOM reports Chinese AG platform conducted sustained overflight of Taiwan at 80,000 feet for six hours.
                        No intercept was possible. None was attempted. They wanted us to see it. <span class="redacted">Message received.</span>"
                        <br><em>— Simulated Presidential Daily Brief, Year 5</em>
                    </p>
                    <ul class="impact-list">
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Carrier Decommissioning</strong>
                                <span>USS Gerald R. Ford in "strategic reserve" (mothballed). Cannot justify crewing $13B target with 5,000 sailors. Surface fleet doctrine collapses globally.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>First Orbital Platforms</strong>
                                <span>Crude but terrifying. Persistent surveillance from any altitude. Kinetic strike capability—just drop mass. No existing treaty covers this.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Chokepoint Collapse</strong>
                                <span>Suez revenue -60%. Panama -45%. Malacca optional. Nations dependent on chokepoint revenue face crisis. Everyone else has options.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Border Security Theater</strong>
                                <span>Every nation quietly abandons real border enforcement. Walls remain for political theater. Security shifts to interior checkpoints, surveillance, and acceptance that some threats are unpreventable.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Terrorism Transformation</strong>
                                <span>First major AG-enabled attack. Target accessed from above. No approach vector to defend. "Secure facility" becomes oxymoron.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Gaining Advantage</strong>
                                <span>Orbital-capable nations, submarine fleets, distributed/redundant architectures, small/mobile/dispersed forces, private security industry (demand explosion).</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Losing Advantage</strong>
                                <span>Fixed military installations, centralized command structures, large concentrated bases, nations without space capability, chokepoint economies.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Containment Failure: Airspace Control</strong>
                                <span>FAA/ICAO attempt AG flight regulations. Unenforceable. You cannot track what you cannot see coming. Black market AG aviation thrives.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Containment Failure: Transfer Controls</strong>
                                <span>Signals indicate dozens of nations now have AG capability. Controls failed.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Containment Failure: Orbital Treaty</strong>
                                <span>Outer Space Treaty update proposed. China/Russia veto. US wouldn't have signed anyway. Space militarization proceeds unchecked.</span>
                            </div>
                        </li>
                    </ul>
                </section>

                <!-- Year 10: Doctrine Revolution -->
                <section class="section" data-section-num="D4" data-year="10" id="defense-year10">
                    <div class="section-header">
                        <h2 class="section-title">Year 10: Doctrine Revolution</h2>
                        <div class="section-status">
                            <span class="status-indicator high" aria-hidden="true"></span>
                            <span>Doctrinal Vocabulary Obsolete</span>
                        </div>
                    </div>

                    <div class="disruption-meter">
                        <div class="meter-header">
                            <span>Strategic Instability Index</span>
                            <span>93%</span>
                        </div>
                        <div class="meter-track">
                            <div class="meter-fill" style="width: 93%"></div>
                        </div>
                        <div class="meter-labels">
                            <span>Contested</span>
                            <span>Uncertain</span>
                            <span>Obsolete</span>
                        </div>
                    </div>

                    <p class="narrative" style="font-style: normal; border-left-color: var(--stamp-red);">
                        "Sir, we need to retire the term 'air superiority.' When a cargo truck can fly, when infantry has vertical
                        mobility, when there is no terrain—the word 'air' loses meaning. We have <span class="redacted">mobility forces</span>.
                        Our entire doctrinal vocabulary is obsolete."
                        <br><em>— Simulated Joint Chiefs Strategic Review, Year 10</em>
                    </p>
                    <ul class="impact-list">
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Surface Navy: History</strong>
                                <span>Last carrier retired globally. Surface combatants: coastal patrol, ceremonial, museums. "Admiral" now means submarine or orbital commander.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Submarine Supremacy Peaks</strong>
                                <span>Ocean depth is only concealment. SSBN sole survivable second-strike. New class: "Arsenal submarines" with AG vertical launch. Nations without subs are strategically naked.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Permanent Orbital Presence</strong>
                                <span>US: 12 platforms. China: 8. Russia: 4. EU: 2. Orbital bombardment—pure kinetic, no warhead—becomes primary strategic threat.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Army Redefinition</strong>
                                <span>"Ground forces" becomes a misnomer. Infantry becomes AG-mobile squads with vertical insertion from any vector. Tanks and large slow platforms vanish. Concealment is everything (thermal/radar/visual signature reduction).</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Fortress Death</strong>
                                <span>No fixed position defensible. Pentagon symbolic only. Cheyenne Mountain defeated by patience and mass. Military shifts to pure mobility.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Gaining Advantage</strong>
                                <span>Nations with submarine industrial bases, space-industrial complexes, AI/autonomous systems developers, dispersed/networked organizations, insurgent movements (asymmetry works both ways).</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Losing Advantage</strong>
                                <span>Conventional powers with expensive legacy systems, nations with concentrated infrastructure, any state without orbital AND submarine capability, the territorial nation-state concept itself.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Containment Failure: Orbital Arms Control</strong>
                                <span>"Orbital Demilitarization Treaty" proposed. No major power signs. Dead on arrival.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Containment Failure: AG Weapons Ban</strong>
                                <span>Dual-use by nature. Like banning sharpened sticks after inventing metallurgy. Unenforceable.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Containment Failure: Private AG Prohibition</strong>
                                <span>Corporations develop better AG capability than most nations. Can't be stopped. Won't be stopped.</span>
                            </div>
                        </li>
                    </ul>
                </section>

                <!-- Year 25: New Equilibrium -->
                <section class="section" data-section-num="D5" data-year="25" id="defense-year25">
                    <div class="section-header">
                        <h2 class="section-title">Year 25: New Strategic Equilibrium</h2>
                        <div class="section-status">
                            <span class="status-indicator high" aria-hidden="true"></span>
                            <span>Territory Deprecated</span>
                        </div>
                    </div>

                    <div class="disruption-meter">
                        <div class="meter-header">
                            <span>Strategic Instability Index</span>
                            <span>96%</span>
                        </div>
                        <div class="meter-track">
                            <div class="meter-fill" style="width: 96%"></div>
                        </div>
                        <div class="meter-labels">
                            <span>Contested</span>
                            <span>Uncertain</span>
                            <span>Obsolete</span>
                        </div>
                    </div>

                    <p class="narrative" style="font-style: normal; border-left-color: var(--stamp-red);">
                        "The concept of 'national defense' is deprecated. You cannot defend territory when territory has no meaning.
                        What we have instead is '<span class="redacted">competitive persistence</span>'—the ability to operate and survive in an
                        environment where anyone can reach anything."
                        <br><em>— Simulated War College Doctrine, Year 25</em>
                    </p>
                    <ul class="impact-list">
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Surface Navies: History</strong>
                                <span>Last surface combatants decommissioned (ceremonial at most). Naval museums feature carriers, destroyers, and the entire concept of "fleet." Naval power = submarine power + orbital power. Nothing else counts.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Orbital Industrial = Military Power</strong>
                                <span>Mass in orbit = strike capability. Manufacturing in orbit = sustained ops. Earth-based military matters only for submarines.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>The Asteroid Question</strong>
                                <span>First proposals for captured asteroids as strategic assets. 500m nickel-iron = extinction-level kinetic weapon. "Dinosaur killer on demand" enters vocabulary.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Nuclear Uncertainty</strong>
                                <span>Delivery trivial, detection impossible, attribution difficult. MAD becomes "Mutually Assured Uncertainty." Grey threat—everyone has them, no one admits it.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Nation-State Stress</strong>
                                <span>Core functions erode: territorial control becomes impossible, borders fictional, monopoly on violence laughable (corporations have AG fleets), tax collection harder when anyone can leave anywhere. What replaces it: network states, corporate territories, orbital sovereignties, ideological confederations.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Gaining Advantage</strong>
                                <span>Orbital industrial powers, submarine-industrial nations, network organizations, corporations with AG/orbital capability, distributed governance structures.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Losing Advantage</strong>
                                <span>Traditional nation-states, territory-defined entities, centralized governments, anyone dependent on Earth-surface control, the Westphalian order itself.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Containment Failure: Orbital Sovereignty Treaty</strong>
                                <span>Attempt to extend territorial-waters logic to orbit. Ignored by everyone who matters.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Containment Failure: Corporate Military Limits</strong>
                                <span>Proposals to cap private AG/orbital capacity fail when corporations threaten relocation to orbital platforms beyond jurisdiction.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Containment Failure: Asteroid Capture Ban</strong>
                                <span>No verification mechanism exists. Treaty survives on paper only.</span>
                            </div>
                        </li>
                    </ul>
                </section>

                <!-- Year 50: Orbital Supremacy -->
                <section class="section" data-section-num="D6" data-year="50" id="defense-year50">
                    <div class="section-header">
                        <h2 class="section-title">Year 50: Orbital Supremacy Era</h2>
                        <div class="section-status">
                            <span class="status-indicator high" aria-hidden="true"></span>
                            <span>Orbital-Industrial Power</span>
                        </div>
                    </div>

                    <div class="disruption-meter">
                        <div class="meter-header">
                            <span>Strategic Instability Index</span>
                            <span>98%</span>
                        </div>
                        <div class="meter-track">
                            <div class="meter-fill" style="width: 98%"></div>
                        </div>
                        <div class="meter-labels">
                            <span>Contested</span>
                            <span>Uncertain</span>
                            <span>Obsolete</span>
                        </div>
                    </div>

                    <p class="narrative" style="font-style: normal; border-left-color: var(--stamp-red);">
                        "We no longer speak of 'superpowers.' The term is '<span class="redacted">orbital-industrial complexes</span>.' There are three
                        that matter: American Consortium, Chinese Authority, Euro-Indian Alliance. Russia is a submarine power
                        with pretensions. Everyone else is a client state or a market."
                        <br><em>— Simulated Geopolitical Assessment, Year 50</em>
                    </p>
                    <ul class="impact-list">
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Earth Military: Ceremonial</strong>
                                <span>Ground forces for disaster response and tradition. Actual power projection: 100% orbital + submarine. Everything else is internal security.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Three Orbital Powers</strong>
                                <span>American Consortium: largest orbital manufacturing. Chinese Authority: most aggressive expansion, 50K+ orbital population. Euro-Indian: most advanced AG tech.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Asteroid Deterrence</strong>
                                <span>Three powers each control captured asteroids. Positioned in stable orbits. Capable of deorbit on command. Nuclear weapons now tertiary concern.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Earth-Orbital Divide</strong>
                                <span>New class structure: orbital citizens (space-industrial workers, orbital-born) vs Earth population ("legacy humanity"). Military service bifurcates; cultures and loyalties diverge.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Invasion Redefined</strong>
                                <span>Traditional invasion impossible. Instead: economic coercion, infrastructure targeting, population pressure. Conquest without occupation.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Gaining Advantage</strong>
                                <span>Orbital-industrial complexes (the power centers), submarine nations (niche but survivable), space-born populations, post-territorial corporate entities, anyone who got to orbit early.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Losing Advantage</strong>
                                <span>Earth-bound nation-states, territorial governments, surface-dependent economies, late-to-space nations (permanent second-tier status), traditional military-industrial complexes.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Containment Failure: Earth-Orbital Treaty Organization</strong>
                                <span>Attempts to keep Earth governments in control of orbital assets fail as orbital populations ignore directives.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Containment Failure: Asteroid Control Regime</strong>
                                <span>Proposed international authority over asteroid resources/weapons rejected by the three powers.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Containment Failure: Orbital Independence</strong>
                                <span>Platforms declare autonomy. Earth-based responses ineffective. What are you going to do—ground them?</span>
                            </div>
                        </li>
                    </ul>
                </section>

                <!-- Year 100: Post-Terrestrial -->
                <section class="section" data-section-num="D7" data-year="100" id="defense-year100">
                    <div class="section-header">
                        <h2 class="section-title">Year 100: Post-Terrestrial Warfare</h2>
                        <div class="section-status">
                            <span class="status-indicator high" aria-hidden="true"></span>
                            <span>Solar System Scale</span>
                        </div>
                    </div>

                    <div class="disruption-meter">
                        <div class="meter-header">
                            <span>Strategic Instability Index</span>
                            <span>99%</span>
                        </div>
                        <div class="meter-track">
                            <div class="meter-fill" style="width: 99%"></div>
                        </div>
                        <div class="meter-labels">
                            <span>Contested</span>
                            <span>Uncertain</span>
                            <span>Obsolete</span>
                        </div>
                    </div>

                    <p class="narrative" style="font-style: normal; border-left-color: var(--stamp-red);">
                        "The entity requesting this briefing self-identifies as the 'Solar Logistics Cooperative'—habitats, mining ops,
                        Mars colonies. They ask about '<span class="redacted">Earth defense arrangements</span>.' They view Earth as a single actor.
                        They may be correct. We are no longer certain who 'we' refers to."
                        <br><em>— Simulated Strategic Communication, Year 100</em>
                    </p>
                    <ul class="impact-list">
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Nation-State: Historical Curiosity</strong>
                                <span>Territorial states persist as administrative conveniences, cultural zones, historical theme parks. Westphalian order: dead 50 years, finally acknowledged.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Solar System-Scale Military Considerations</strong>
                                <span>Strategic geography measured in AU: inner system (Earth orbit to Mars) is densest; belt is the industrial heartland; outer system is frontier. Interplanetary transit is the vulnerable phase. Warning times measured in hours to weeks.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Interplanetary Power Projection</strong>
                                <span>True power projection is limited to former-Earth orbital complexes, the growing Mars industrial combine, and a distributed belt confederation. Earth is largely demilitarized—protected by orbital complexes, emigration heavy, tourism dominant.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Post-Human Military</strong>
                                <span>Human soldiers largely obsolete. Autonomous systems handle operations. Humans: strategic decision, ethical oversight. "Soldier" is administrative role.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>The Long Peace or Preparation</strong>
                                <span>Two schools: Mutual destruction so absolute war is obsolete. Or: consolidation phase before unimaginable conflict. Evidence supports both.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Gaining Advantage</strong>
                                <span>Early orbital movers, distributed/resilient organizational forms, post-biological/hybrid entities, interplanetary-native populations, whoever controls helium-3 and water ice.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Losing Advantage</strong>
                                <span>Earth-centric thinking, centralized hierarchies (too slow/fragile), carbon-chauvinist doctrine, late-space civilizations, anyone still thinking in national terms.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Containment Failure: Solar Governance Treaty</strong>
                                <span>Attempt at solar-system-wide governance collapses (belt rejects, Mars ambivalent). Fails.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Containment Failure: AI Military Limitation</strong>
                                <span>Proposals for strict human control become impractical; human reaction time is insufficient for interplanetary warfare. Quietly abandoned.</span>
                            </div>
                        </li>
                        <li class="impact-item">
                            <div class="impact-marker"></div>
                            <div class="impact-text">
                                <strong>Containment Failure: Earth Reunification</strong>
                                <span>Repeated attempts to reconstitute Earth under a single government fail. Population indifferent; orbital powers prefer a divided customer base.</span>
                            </div>
                        </li>
                    </ul>
                </section>

            </section>
        </main>
    </div>

    <script>
        // Economic Model State
        const state = {
            adoptionRate: 20,
            energyCost: 50,
            payload: 60,
            regulation: 50,
            discoveryContext: 'corporation',
            timelineYear: 100
        };

        // Scenario parameters are "committed" when projections are recalculated.
        // The timeline year is always live and can be scrubbed without recalculation.
        let committedScenario = {
            adoptionRate: state.adoptionRate,
            energyCost: state.energyCost,
            payload: state.payload,
            regulation: state.regulation,
            discoveryContext: state.discoveryContext
        };

        let lastImpacts = null;

        const PROJECTION_MARKERS = [1, 3, 5, 10, 25, 50, 100];
        const TIMELINE_HORIZON = PROJECTION_MARKERS[PROJECTION_MARKERS.length - 1];

        function getVizParams() {
            return { ...committedScenario, timelineYear: state.timelineYear };
        }

        // Sector base disruption values (0-100)
        const SECTOR_BASES = {
            transport: 94,
            realestate: 87,
            energy: 62,
            labor: 78,
            supply: 91,
            military: 89,
            space: 96,
            urban: 73
        };

        // Calculate sector impacts based on parameters
        function calculateSectorImpacts(params) {
            const { adoptionRate, energyCost, payload, regulation, discoveryContext } = params;

            // Modifiers based on parameters
            const adoptionMod = (100 - adoptionRate) / 100; // Faster adoption = more disruption
            const energyMod = (100 - energyCost) / 100; // Lower energy cost = more disruption
            const payloadMod = payload / 100; // Higher payload = more disruption
            const regulationMod = (100 - regulation) / 100; // Less regulation = more disruption

            // Discovery context modifiers
            const contextMods = {
                government: { military: 1.2, space: 1.3, transport: 0.8 },
                corporation: { transport: 1.1, supply: 1.2, realestate: 1.1 },
                individual: { urban: 1.2, realestate: 1.3, transport: 1.0 },
                accident: { military: 0.9, regulation: 1.3, transport: 1.1 }
            };

            const ctxMod = contextMods[discoveryContext] || {};

            const impacts = {};
            Object.keys(SECTOR_BASES).forEach(sector => {
                let base = SECTOR_BASES[sector];
                let mod = (adoptionMod + energyMod + payloadMod + regulationMod) / 4;
                let ctxFactor = ctxMod[sector] || 1;

                // Special cases
                if (sector === 'energy') {
                    // Energy disruption depends heavily on energy cost parameter
                    mod = energyMod * 0.8 + (adoptionMod + payloadMod) * 0.1;
                }
                if (sector === 'space') {
                    // Space is less affected by regulation
                    mod = (adoptionMod + energyMod + payloadMod) / 3 * 1.1;
                }

                impacts[sector] = Math.min(100, Math.max(0, Math.round(base * mod * ctxFactor)));
            });

            return impacts;
        }

        // Calculate job displacement
        function calculateJobDisplacement(impacts) {
            const baseJobs = {
                transport: 15.2,  // millions
                logistics: 12.4,
                services: 8.7,
                manufacturing: 6.2,
                realestate: 4.8
            };

            const avgDisruption = Object.values(impacts).reduce((a, b) => a + b, 0) / Object.keys(impacts).length / 100;

            const lost = {
                transport: baseJobs.transport * (impacts.transport / 100),
                logistics: baseJobs.logistics * (impacts.supply / 100),
                services: baseJobs.services * avgDisruption,
                manufacturing: baseJobs.manufacturing * avgDisruption * 0.5,
                realestate: baseJobs.realestate * (impacts.realestate / 100) * 0.6
            };

            const totalLost = Object.values(lost).reduce((a, b) => a + b, 0);

            // New jobs created (rough estimate: 40% of lost jobs eventually replaced)
            const gained = {
                agTech: totalLost * 0.15,
                space: totalLost * 0.08,
                construction: totalLost * 0.12,
                services: totalLost * 0.05
            };

            const totalGained = Object.values(gained).reduce((a, b) => a + b, 0);

            return {
                lost: totalLost,
                gained: totalGained,
                net: totalGained - totalLost
            };
        }

        // Generate narrative text based on parameters
        function generateNarrative(sector, params, impacts) {
            const narratives = {
                transport: {
                    high: `At current parameters, the first commercial antigravity cargo platform enters service within five years. By year fifteen, traditional shipping routes become archaeological curiosities. The Port of Shanghai transforms into the world's largest floating logistics hub, processing cargo that never touches water.`,
                    mid: `With moderate adoption rates and controlled regulation, traditional transportation enters a prolonged decline rather than sudden collapse. Hybrid systems emerge—antigravity for premium cargo, conventional methods for bulk commodities. The transition spans decades rather than years.`,
                    low: `Heavy regulation and energy costs slow antigravity adoption significantly. Traditional transportation infrastructure receives a reprieve, but investment shifts toward preparation rather than expansion. Everyone knows the change is coming—the question is when.`
                },
                realestate: {
                    high: `The fundamental premise of real estate—location, location, location—dissolves overnight. Manhattan square footage trades at parity with Kansas farmland. The only remaining premium: views and neighbors.`,
                    mid: `Location premiums compress but don't disappear entirely. Cultural centers, established communities, and natural amenities retain value. The market bifurcates: commodity space versus experiential living.`,
                    low: `Real estate markets adjust gradually as antigravity remains expensive and regulated. Premium locations retain value longer, but the writing is on the wall. Smart investors begin repositioning.`
                },
                energy: {
                    high: `With low energy requirements, antigravity devastates transportation fuel markets. Gasoline, diesel, jet fuel demand craters. Refineries close. The oil industry pivots desperately toward petrochemicals.`,
                    mid: `At current parameter settings, antigravity requires moderate energy input—enough to disrupt transportation fuels while preserving the broader energy infrastructure.`,
                    low: `High energy requirements mean antigravity increases overall electricity demand. Nuclear and renewables become critical. The grid expansion required rivals the 20th century electrification effort.`
                },
                labor: {
                    high: `Fifty million transport workers globally face obsolescence. The cascade extends through logistics, warehousing, fuel stations, roadside services. New jobs emerge in antigravity maintenance, vertical construction, and space operations—but the transition period is brutal.`,
                    mid: `Labor markets face significant disruption, but the slower adoption timeline allows for adaptation. Retraining programs proliferate. Some workers transition; many don't. Social safety nets strain but hold.`,
                    low: `With controlled rollout, labor displacement spreads over decades. Generational turnover absorbs much of the impact. Still, specific regions and demographics face concentrated pain.`
                },
                supply: {
                    high: `Just-in-time manufacturing reaches its logical conclusion: minutes from factory to consumer. Why maintain inventory when replenishment is instant? Why build warehouses when the sky is the warehouse?`,
                    mid: `Supply chains optimize around antigravity where available, but geographic concentration shifts rather than disappears. Labor costs become the dominant factor in location decisions.`,
                    low: `Supply chain transformation proceeds gradually. Early adopters gain competitive advantage; laggards face increasing pressure. The transition rewards agility over scale.`
                },
                military: {
                    high: `Aircraft carriers become the most expensive targets in history. Fortifications cease to exist. Every nation with antigravity can project power anywhere, instantly. The calculus of defense inverts entirely.`,
                    mid: `Military doctrine evolves rapidly, but legacy systems retain some relevance during the transition. Asymmetric advantages emerge for early adopters. Arms races accelerate.`,
                    low: `Controlled proliferation allows military establishments time to adapt. New doctrines emerge incrementally. The transformation is revolutionary but not overnight.`
                },
                space: {
                    high: `Launch costs drop from $2,720/kg to effectively zero. The rocket equation becomes a historical footnote. Orbital infrastructure explodes. The Moon becomes a weekend destination. Mars colonization shifts from decades to years.`,
                    mid: `Space access expands dramatically, but regulatory frameworks struggle to keep pace. Orbital territory disputes emerge. The space economy grows exponentially but chaotically.`,
                    low: `Space programs accelerate, but government control keeps commercial development measured. Strategic orbital positions are secured. The space race restarts under new rules.`
                },
                urban: {
                    high: `Paradoxically, the end of commuting reverses suburban sprawl. When you can live anywhere, density becomes a choice rather than a necessity. Cities transform from transportation hubs into cultural centers. Roads become parks.`,
                    mid: `Urban transformation proceeds unevenly. Some cities embrace vertical expansion and floating infrastructure; others cling to traditional patterns. A new urban hierarchy emerges based on adaptability.`,
                    low: `City planning adapts gradually. Pilot projects demonstrate floating structures and 3D urban grids. Full transformation awaits broader antigravity adoption.`
                }
            };

            const impact = impacts[sector];
            const intensity = impact >= 80 ? 'high' : impact >= 50 ? 'mid' : 'low';

            return narratives[sector]?.[intensity] || narratives[sector]?.['mid'];
        }

        // Update UI with new calculations
        function updateUI() {
            committedScenario = {
                adoptionRate: state.adoptionRate,
                energyCost: state.energyCost,
                payload: state.payload,
                regulation: state.regulation,
                discoveryContext: state.discoveryContext
            };

            const impacts = calculateSectorImpacts(committedScenario);
            const jobs = calculateJobDisplacement(impacts);
            lastImpacts = impacts;

            // Update meters
            Object.keys(impacts).forEach(sector => {
                const meter = document.getElementById(`${sector}-meter`);
                const pct = document.getElementById(`${sector}-pct`);
                if (meter) {
                    meter.style.width = `${impacts[sector]}%`;
                }
                if (pct) {
                    pct.textContent = `${impacts[sector]}%`;
                }

                // Update status indicator
                const section = document.getElementById(sector);
                if (section) {
                    const indicator = section.querySelector('.status-indicator');
                    if (indicator) {
                        indicator.classList.remove('high', 'mid');
                        if (impacts[sector] >= 80) indicator.classList.add('high');
                        else if (impacts[sector] >= 50) indicator.classList.add('mid');
                    }
                }

                // Update narrative
                const narrative = document.getElementById(`${sector}-narrative`);
                if (narrative) {
                    narrative.innerHTML = generateNarrative(sector, committedScenario, impacts);
                }
            });

            // Update job counters with animation
            animateCounter('jobs-lost', -jobs.lost, 'M');
            animateCounter('jobs-gained', jobs.gained, 'M');
            animateCounter('jobs-net', jobs.net, 'M');

            // Update Sankey diagram
            updateSankeyDiagram(impacts, { animate: true });

            // Update world map
            updateWorldMap(impacts, { animate: true });

            // Update cascade timeline
            updateCascadeTimeline(impacts, { animate: true });
        }

        function updateTimeSliceVisuals(opts = {}) {
            filterSectionsByYear(state.timelineYear);
            if (!lastImpacts) return;
            updateSankeyDiagram(lastImpacts, opts);
            updateWorldMap(lastImpacts, opts);
            updateCascadeTimeline(lastImpacts, opts);
        }

        function filterSectionsByYear(selectedYear) {
            const year = parseInt(selectedYear, 10);
            if (!Number.isFinite(year)) return;

            const sections = document.querySelectorAll('.tab-content .section[data-year]');
            sections.forEach(section => {
                const sectionYear = parseInt(section.dataset.year, 10);
                if (!Number.isFinite(sectionYear)) return;
                section.hidden = sectionYear > year;
            });
        }

        // Animate counter values
        function animateCounter(id, targetValue, suffix) {
            const el = document.getElementById(id);
            if (!el) return;

            const current = parseFloat(el.textContent.replace(/[^\d.-]/g, '')) || 0;
            const diff = targetValue - current;
            const steps = 30;
            const stepValue = diff / steps;
            let step = 0;

            const interval = setInterval(() => {
                step++;
                const value = current + (stepValue * step);
                const prefix = value >= 0 ? '+' : '';
                el.textContent = `${prefix}${value.toFixed(1)}${suffix}`;

                // Update class based on value
                el.classList.remove('positive', 'negative', 'neutral');
                if (value > 0.5) el.classList.add('positive');
                else if (value < -0.5) el.classList.add('negative');
                else el.classList.add('neutral');

                if (step >= steps) clearInterval(interval);
            }, 20);
        }

        // --- Visualization helpers ---
        const SVG_NS = 'http://www.w3.org/2000/svg';

        const clamp = (v, min, max) => Math.min(max, Math.max(min, v));
        const lerp = (a, b, t) => a + (b - a) * t;
        const easeInOutCubic = (t) => (t < 0.5 ? 4 * t * t * t : 1 - Math.pow(-2 * t + 2, 3) / 2);

        function prefersReducedMotion() {
            return window.matchMedia && window.matchMedia('(prefers-reduced-motion: reduce)').matches;
        }

        function formatTrillions(v) {
            if (!Number.isFinite(v)) return '';
            if (v >= 10) return `$${v.toFixed(1)}T`;
            return `$${v.toFixed(2)}T`;
        }

        function adoptionProgressAtYear(year, params) {
            const t = clamp(year, 0, TIMELINE_HORIZON);
            const adoptionYears = clamp(params.adoptionRate || 20, 1, 100);
            const mid = adoptionYears * 0.5
                + ((params.regulation ?? 50) - 50) / 100 * 4
                + ((params.energyCost ?? 50) - 50) / 100 * 3
                - ((params.payload ?? 60) - 50) / 100 * 2;
            const k = 8 / Math.max(6, adoptionYears);
            const p = 1 / (1 + Math.exp(-k * (t - mid)));
            return clamp(p, 0, 1);
        }

        function normalizeWeights(weights) {
            const entries = Object.entries(weights);
            const sum = entries.reduce((acc, [, v]) => acc + Math.max(0, v), 0);
            if (sum <= 0) {
                return Object.fromEntries(entries.map(([k]) => [k, 0]));
            }
            return Object.fromEntries(entries.map(([k, v]) => [k, Math.max(0, v) / sum]));
        }

        // --- Sankey model + renderer (SVG) ---
        let sankeyRenderer = null;

        function buildSankeyModel(impacts, params) {
            const left = [
                { id: 'transport', name: 'Transport Networks', value: 14.1, color: 'var(--flow-transport)' },
                { id: 'supply', name: 'Supply Chain', value: 7.8, color: 'var(--flow-supply)' },
                { id: 'realestate', name: 'Real Estate', value: 9.2, color: 'var(--flow-realestate)' },
                { id: 'energy', name: 'Energy & Fuels', value: 8.4, color: 'var(--flow-energy)' },
                { id: 'labor', name: 'Labor Services', value: 12.6, color: 'var(--flow-labor)' },
                { id: 'military', name: 'Military Procurement', value: 2.3, color: 'var(--flow-military)' }
            ];

            const right = [
                { id: 'legacy', name: 'Legacy / Hybrid Systems', color: 'var(--ink-light)' },
                { id: 'agMobility', name: 'AG Mobility & Logistics', color: 'var(--flow-transport)' },
                { id: 'urban', name: 'Vertical & Floating RE', color: 'var(--flow-urban)' },
                { id: 'grid', name: 'Grid & Power Buildout', color: 'var(--flow-energy)' },
                { id: 'space', name: 'Space Economy', color: 'var(--flow-space)' },
                { id: 'defense', name: 'Defense Platforms', color: 'var(--flow-military)' },
                { id: 'stranded', name: 'Stranded Assets', color: 'var(--stamp-red)' }
            ];

            const p = adoptionProgressAtYear(params.timelineYear ?? 10, params);

            const d = {
                transport: clamp((impacts.transport ?? 0) / 100, 0, 1),
                supply: clamp((impacts.supply ?? 0) / 100, 0, 1),
                realestate: clamp((impacts.realestate ?? 0) / 100, 0, 1),
                energy: clamp((impacts.energy ?? 0) / 100, 0, 1),
                labor: clamp((impacts.labor ?? 0) / 100, 0, 1),
                military: clamp((impacts.military ?? 0) / 100, 0, 1),
                space: clamp((impacts.space ?? 0) / 100, 0, 1)
            };

            const regulation = clamp((params.regulation ?? 50) / 100, 0, 1);
            const payload = clamp((params.payload ?? 60) / 100, 0, 1);
            const gridNeed = clamp((params.energyCost ?? 50) / 100, 0, 1);

            const perSectorFinal = {
                transport: normalizeWeights({
                    legacy: 1.4 * (1 - d.transport) + 0.15 * regulation,
                    agMobility: 2.0 * d.transport + 0.35 * payload,
                    urban: 0.35 * d.transport,
                    grid: 0.20 * d.transport * gridNeed,
                    space: 0.55 * d.transport * payload,
                    defense: 0.20 * d.transport * d.military,
                    stranded: 1.25 * d.transport * (0.75 - 0.45 * regulation)
                }),
                supply: normalizeWeights({
                    legacy: 1.25 * (1 - d.supply) + 0.10 * regulation,
                    agMobility: 1.55 * d.supply + 0.25 * payload,
                    urban: 0.45 * d.supply,
                    grid: 0.18 * d.supply * gridNeed,
                    space: 0.35 * d.supply * payload,
                    defense: 0.18 * d.supply * d.military,
                    stranded: 1.05 * d.supply * (0.7 - 0.35 * regulation)
                }),
                realestate: normalizeWeights({
                    legacy: 1.3 * (1 - d.realestate) + 0.18 * regulation,
                    agMobility: 0.30 * d.realestate,
                    urban: 2.05 * d.realestate + 0.10 * payload,
                    grid: 0.30 * d.realestate * gridNeed,
                    space: 0.35 * d.realestate * d.space,
                    defense: 0.22 * d.realestate * d.military,
                    stranded: 1.10 * d.realestate * (0.8 - 0.4 * regulation)
                }),
                energy: normalizeWeights({
                    legacy: 1.45 * (1 - d.energy) + 0.20,
                    agMobility: 0.35 * d.energy,
                    urban: 0.15 * gridNeed,
                    grid: 1.15 * gridNeed + 0.10,
                    space: 0.20 * d.energy * payload,
                    defense: 0.10 * d.energy * d.military,
                    stranded: 1.55 * d.energy * (1 - 0.75 * gridNeed)
                }),
                labor: normalizeWeights({
                    legacy: 1.15 * (1 - d.labor) + 0.20 * regulation,
                    agMobility: 1.10 * d.labor,
                    urban: 1.00 * d.labor,
                    grid: 0.30 * d.labor * gridNeed,
                    space: 0.50 * d.labor * d.space,
                    defense: 0.30 * d.labor * d.military,
                    stranded: 1.40 * d.labor * (0.85 - 0.55 * regulation)
                }),
                military: normalizeWeights({
                    legacy: 1.35 * (1 - d.military) + 0.25 * regulation,
                    agMobility: 0.20 * d.military,
                    urban: 0.08 * d.military,
                    grid: 0.12 * d.military * gridNeed,
                    space: 0.95 * d.military * d.space,
                    defense: 1.55 * d.military,
                    stranded: 0.85 * d.military * (0.75 - 0.45 * regulation)
                })
            };

            const perSectorInitial = {
                transport: { legacy: 0.93, stranded: 0.07 },
                supply: { legacy: 0.94, stranded: 0.06 },
                realestate: { legacy: 0.95, stranded: 0.05 },
                energy: { legacy: 0.96, stranded: 0.04 },
                labor: { legacy: 0.96, stranded: 0.04 },
                military: { legacy: 0.98, stranded: 0.02 }
            };

            const rightIndex = Object.fromEntries(right.map((n, i) => [n.id, i]));
            const links = [];

            for (const source of left) {
                const initial = perSectorInitial[source.id] || { legacy: 1 };
                const final = perSectorFinal[source.id] || { legacy: 1 };

                // Ensure both distributions cover all targets
                const targets = right.map(n => n.id);
                const initialFull = Object.fromEntries(targets.map(tid => [tid, initial[tid] ?? 0]));
                const finalFull = Object.fromEntries(targets.map(tid => [tid, final[tid] ?? 0]));

                const currentFracs = Object.fromEntries(targets.map(tid => [tid, lerp(initialFull[tid], finalFull[tid], p)]));
                // Renormalize for safety (numerical drift)
                const norm = normalizeWeights(currentFracs);

                for (const targetId of targets) {
                    const value = source.value * (norm[targetId] || 0);
                    links.push({
                        id: `${source.id}→${targetId}`,
                        source: source.id,
                        target: targetId,
                        value,
                        color: source.color,
                        targetIndex: rightIndex[targetId] ?? 0
                    });
                }
            }

            // Stable ordering: group by source, then by target order to reduce crossing
            links.sort((a, b) => {
                if (a.source !== b.source) return a.source.localeCompare(b.source);
                return (a.targetIndex ?? 0) - (b.targetIndex ?? 0);
            });

            const rightTotals = Object.fromEntries(right.map(n => [n.id, 0]));
            for (const link of links) {
                rightTotals[link.target] = (rightTotals[link.target] || 0) + link.value;
            }
            right.forEach(n => { n.value = rightTotals[n.id] || 0; });

            return { left, right, links, progress: p };
        }

        function computeSankeyLayout(model, width, height) {
            const margin = { top: 18, right: 160, bottom: 18, left: 160 };
            const nodeWidth = 14;
            const nodePad = 10;
            const leftX0 = margin.left;
            const leftX1 = leftX0 + nodeWidth;
            const rightX1 = width - margin.right;
            const rightX0 = rightX1 - nodeWidth;

            const leftNodes = model.left.map(n => ({ ...n, column: 'left' }));
            const rightNodes = model.right.map(n => ({ ...n, column: 'right' }));
            const nodes = [...leftNodes, ...rightNodes];

            const leftTotal = leftNodes.reduce((a, n) => a + n.value, 0);
            const rightTotal = rightNodes.reduce((a, n) => a + n.value, 0);
            const total = Math.max(leftTotal, rightTotal, 1e-6);

            const available = height - margin.top - margin.bottom;
            const leftAvail = available - nodePad * (leftNodes.length - 1);
            const rightAvail = available - nodePad * (rightNodes.length - 1);
            const scale = Math.min(leftAvail, rightAvail) / total;

            function stackColumn(list, x0, x1, startY) {
                let y = startY;
                for (const n of list) {
                    const h = n.value * scale;
                    n.x0 = x0;
                    n.x1 = x1;
                    n.y0 = y;
                    n.y1 = y + h;
                    y += h + nodePad;
                }
            }

            const colHeight = (list) => (
                list.reduce((acc, n) => acc + n.value * scale, 0) + nodePad * (list.length - 1)
            );
            const leftStart = margin.top + (available - colHeight(leftNodes)) / 2;
            const rightStart = margin.top + (available - colHeight(rightNodes)) / 2;

            stackColumn(leftNodes, leftX0, leftX1, leftStart);
            stackColumn(rightNodes, rightX0, rightX1, rightStart);

            const nodeById = Object.fromEntries(nodes.map(n => [n.id, n]));

            const links = model.links.map(l => {
                const source = nodeById[l.source];
                const target = nodeById[l.target];
                const thickness = l.value * scale;
                return {
                    ...l,
                    thickness,
                    x0: source.x1,
                    x1: target.x0,
                    y0: source.y0,
                    y1: target.y0
                };
            });

            // Stack outgoing (by target position) and incoming (by source position) to reduce crossings
            const byId = Object.fromEntries(links.map(l => [l.id, l]));
            const outgoing = {};
            const incoming = {};
            for (const l of links) {
                (outgoing[l.source] || (outgoing[l.source] = [])).push(l);
                (incoming[l.target] || (incoming[l.target] = [])).push(l);
            }

            for (const n of leftNodes) {
                const list = (outgoing[n.id] || []).slice()
                    .sort((a, b) => (nodeById[a.target].y0 - nodeById[b.target].y0));
                let y = n.y0;
                for (const l of list) {
                    const t = l.thickness;
                    byId[l.id].y0 = y + t / 2;
                    y += t;
                }
            }

            for (const n of rightNodes) {
                const list = (incoming[n.id] || []).slice()
                    .sort((a, b) => (nodeById[a.source].y0 - nodeById[b.source].y0));
                let y = n.y0;
                for (const l of list) {
                    const t = l.thickness;
                    byId[l.id].y1 = y + t / 2;
                    y += t;
                }
            }

            return {
                width,
                height,
                nodeWidth,
                nodes,
                leftNodes,
                rightNodes,
                links,
                progress: model.progress
            };
        }

        function ribbonPath(link) {
            const x0 = link.x0;
            const x1 = link.x1;
            const xi = lerp(x0, x1, 0.5);

            const t = Math.max(0.0001, link.thickness);
            const y0a = link.y0 - t / 2;
            const y0b = link.y0 + t / 2;
            const y1a = link.y1 - t / 2;
            const y1b = link.y1 + t / 2;

            return [
                `M ${x0.toFixed(3)} ${y0a.toFixed(3)}`,
                `C ${xi.toFixed(3)} ${y0a.toFixed(3)}, ${xi.toFixed(3)} ${y1a.toFixed(3)}, ${x1.toFixed(3)} ${y1a.toFixed(3)}`,
                `L ${x1.toFixed(3)} ${y1b.toFixed(3)}`,
                `C ${xi.toFixed(3)} ${y1b.toFixed(3)}, ${xi.toFixed(3)} ${y0b.toFixed(3)}, ${x0.toFixed(3)} ${y0b.toFixed(3)}`,
                'Z'
            ].join(' ');
        }

        function ribbonCenterPath(link) {
            const x0 = link.x0;
            const x1 = link.x1;
            const xi = lerp(x0, x1, 0.5);
            return [
                `M ${x0.toFixed(3)} ${link.y0.toFixed(3)}`,
                `C ${xi.toFixed(3)} ${link.y0.toFixed(3)}, ${xi.toFixed(3)} ${link.y1.toFixed(3)}, ${x1.toFixed(3)} ${link.y1.toFixed(3)}`
            ].join(' ');
        }

        class SankeyRenderer {
            constructor(svg) {
                this.svg = svg;
                this.prev = null;
                this.nodes = new Map();
                this.labels = new Map();
                this.links = new Map();
                this.flows = new Map();

                // Build fixed structure
                while (this.svg.firstChild) this.svg.removeChild(this.svg.firstChild);

                const defs = document.createElementNS(SVG_NS, 'defs');
                defs.innerHTML = `
                    <filter id="sankeyShadow" x="-20%" y="-20%" width="140%" height="140%">
                        <feDropShadow dx="0" dy="1" stdDeviation="1" flood-color="rgba(0,0,0,0.18)"/>
                    </filter>
                `;
                this.svg.appendChild(defs);

                this.gBack = document.createElementNS(SVG_NS, 'g');
                this.gLinks = document.createElementNS(SVG_NS, 'g');
                this.gFlows = document.createElementNS(SVG_NS, 'g');
                this.gNodes = document.createElementNS(SVG_NS, 'g');
                this.gLabels = document.createElementNS(SVG_NS, 'g');

                this.gBack.setAttribute('opacity', '0.8');
                this.gLinks.setAttribute('filter', 'url(#sankeyShadow)');
                this.gLinks.setAttribute('style', 'mix-blend-mode:multiply');
                this.gFlows.setAttribute('style', 'mix-blend-mode:screen');
                this.gNodes.setAttribute('filter', 'url(#sankeyShadow)');
                this.gLabels.setAttribute('pointer-events', 'none');

                this.svg.appendChild(this.gBack);
                this.svg.appendChild(this.gLinks);
                this.svg.appendChild(this.gFlows);
                this.svg.appendChild(this.gNodes);
                this.svg.appendChild(this.gLabels);
            }

            ensureLink(id, color) {
                let el = this.links.get(id);
                if (!el) {
                    el = document.createElementNS(SVG_NS, 'path');
                    el.setAttribute('data-id', id);
                    el.setAttribute('fill', color);
                    el.setAttribute('fill-opacity', '0.55');
                    el.setAttribute('stroke', 'rgba(0,0,0,0.18)');
                    el.setAttribute('stroke-width', '0.75');
                    el.setAttribute('vector-effect', 'non-scaling-stroke');
                    el.style.cursor = 'default';

                    const title = document.createElementNS(SVG_NS, 'title');
                    el.appendChild(title);

                    el.addEventListener('mouseenter', () => el.setAttribute('fill-opacity', '0.78'));
                    el.addEventListener('mouseleave', () => el.setAttribute('fill-opacity', '0.55'));

                    this.gLinks.appendChild(el);
                    this.links.set(id, el);
                }
                el.setAttribute('fill', color);
                return el;
            }

            ensureFlow(id) {
                let el = this.flows.get(id);
                if (!el) {
                    el = document.createElementNS(SVG_NS, 'path');
                    el.setAttribute('class', 'sankey-flow');
                    el.setAttribute('vector-effect', 'non-scaling-stroke');
                    el.style.animationDelay = `${(-Math.random() * 1.8).toFixed(2)}s`;
                    this.gFlows.appendChild(el);
                    this.flows.set(id, el);
                }
                return el;
            }

            ensureNode(id, color) {
                let el = this.nodes.get(id);
                if (!el) {
                    el = document.createElementNS(SVG_NS, 'rect');
                    el.setAttribute('rx', '3');
                    el.setAttribute('ry', '3');
                    el.setAttribute('stroke', 'rgba(44, 24, 16, 0.35)');
                    el.setAttribute('stroke-width', '1');
                    el.setAttribute('vector-effect', 'non-scaling-stroke');
                    el.setAttribute('fill', color);
                    el.setAttribute('fill-opacity', '0.18');
                    this.gNodes.appendChild(el);
                    this.nodes.set(id, el);
                }
                el.setAttribute('stroke', 'rgba(44, 24, 16, 0.35)');
                return el;
            }

            ensureLabel(id, anchor) {
                let el = this.labels.get(id);
                if (!el) {
                    el = document.createElementNS(SVG_NS, 'text');
                    el.setAttribute('font-family', "'Berkeley Mono', 'Courier New', monospace");
                    el.setAttribute('font-size', '11');
                    el.setAttribute('fill', 'var(--ink)');
                    el.setAttribute('text-anchor', anchor);
                    el.setAttribute('dominant-baseline', 'middle');

                    const tName = document.createElementNS(SVG_NS, 'tspan');
                    tName.setAttribute('data-part', 'name');
                    tName.setAttribute('font-weight', 'bold');
                    el.appendChild(tName);

                    const tVal = document.createElementNS(SVG_NS, 'tspan');
                    tVal.setAttribute('data-part', 'value');
                    tVal.setAttribute('x', '0');
                    tVal.setAttribute('dy', '12');
                    tVal.setAttribute('font-size', '9');
                    tVal.setAttribute('fill', 'var(--ink-faded)');
                    el.appendChild(tVal);

                    this.gLabels.appendChild(el);
                    this.labels.set(id, el);
                }
                el.setAttribute('text-anchor', anchor);
                return el;
            }

            drawBackground(layout) {
                // Subtle ruled lines for the "field report" look
                if (this._bgDrawn) return;
                this._bgDrawn = true;

                const w = layout.width;
                const h = layout.height;
                const step = 24;
                for (let y = 18; y < h; y += step) {
                    const line = document.createElementNS(SVG_NS, 'line');
                    line.setAttribute('x1', '0');
                    line.setAttribute('x2', String(w));
                    line.setAttribute('y1', String(y));
                    line.setAttribute('y2', String(y));
                    line.setAttribute('stroke', 'rgba(44, 24, 16, 0.06)');
                    line.setAttribute('stroke-width', '1');
                    this.gBack.appendChild(line);
                }
            }

            applyLayout(layout) {
                this.drawBackground(layout);

                // Links
                for (const link of layout.links) {
                    const el = this.ensureLink(link.id, link.color);
                    const d = ribbonPath(link);
                    el.setAttribute('d', d);
                    el.setAttribute('display', link.thickness < 0.6 ? 'none' : 'block');
                    const flow = this.ensureFlow(link.id);
                    flow.setAttribute('d', ribbonCenterPath(link));
                    flow.setAttribute('stroke-width', clamp(link.thickness * 0.06, 0.8, 2.6).toFixed(2));
                    flow.setAttribute('display', link.thickness < 1.2 ? 'none' : 'block');
                    const title = el.querySelector('title');
                    if (title) {
                        title.textContent = `${link.source} → ${link.target}: ${formatTrillions(link.value)}`;
                    }
                }

                // Nodes + labels
                for (const n of layout.nodes) {
                    const rect = this.ensureNode(n.id, n.color || 'var(--ink)');
                    rect.setAttribute('x', n.x0.toFixed(3));
                    rect.setAttribute('y', n.y0.toFixed(3));
                    rect.setAttribute('width', (n.x1 - n.x0).toFixed(3));
                    rect.setAttribute('height', Math.max(0.5, n.y1 - n.y0).toFixed(3));

                    const isLeft = n.column === 'left';
                    const label = this.ensureLabel(n.id, isLeft ? 'end' : 'start');
                    const x = isLeft ? (n.x0 - 10) : (n.x1 + 10);
                    const y = (n.y0 + n.y1) / 2;
                    label.setAttribute('x', x.toFixed(3));
                    label.setAttribute('y', y.toFixed(3));

                    const [tName, tVal] = Array.from(label.querySelectorAll('tspan'));
                    if (tName) tName.textContent = n.name;
                    if (tVal) {
                        tVal.setAttribute('x', x.toFixed(3));
                        tVal.textContent = formatTrillions(n.value);
                    }
                }
            }

            animateTo(next, durationMs = 700) {
                const start = performance.now();
                const prev = this.prev;
                const reduced = prefersReducedMotion();
                if (!prev || reduced) {
                    this.applyLayout(next);
                    this.prev = next;
                    return;
                }

                const prevLinks = Object.fromEntries(prev.links.map(l => [l.id, l]));
                const prevNodes = Object.fromEntries(prev.nodes.map(n => [n.id, n]));

                const tick = (now) => {
                    const t = clamp((now - start) / durationMs, 0, 1);
                    const e = easeInOutCubic(t);

                    // Interpolate and apply without allocating large new structures each frame.
                    for (const link of next.links) {
                        const a = prevLinks[link.id] || link;
                        const interp = {
                            ...link,
                            x0: lerp(a.x0, link.x0, e),
                            x1: lerp(a.x1, link.x1, e),
                            y0: lerp(a.y0, link.y0, e),
                            y1: lerp(a.y1, link.y1, e),
                            thickness: lerp(a.thickness, link.thickness, e)
                        };
                        const el = this.ensureLink(link.id, link.color);
                        el.setAttribute('d', ribbonPath(interp));
                        el.setAttribute('display', interp.thickness < 0.6 ? 'none' : 'block');

                        const flow = this.ensureFlow(link.id);
                        flow.setAttribute('d', ribbonCenterPath(interp));
                        flow.setAttribute('stroke-width', clamp(interp.thickness * 0.06, 0.8, 2.6).toFixed(2));
                        flow.setAttribute('display', interp.thickness < 1.2 ? 'none' : 'block');
                    }

                    for (const n of next.nodes) {
                        const a = prevNodes[n.id] || n;
                        const y0 = lerp(a.y0, n.y0, e);
                        const y1 = lerp(a.y1, n.y1, e);

                        const rect = this.ensureNode(n.id, n.color || 'var(--ink)');
                        rect.setAttribute('x', n.x0.toFixed(3));
                        rect.setAttribute('y', y0.toFixed(3));
                        rect.setAttribute('width', (n.x1 - n.x0).toFixed(3));
                        rect.setAttribute('height', Math.max(0.5, y1 - y0).toFixed(3));

                        const isLeft = n.column === 'left';
                        const label = this.ensureLabel(n.id, isLeft ? 'end' : 'start');
                        const x = isLeft ? (n.x0 - 10) : (n.x1 + 10);
                        const y = (y0 + y1) / 2;
                        label.setAttribute('x', x.toFixed(3));
                        label.setAttribute('y', y.toFixed(3));
                        const [tName, tVal] = Array.from(label.querySelectorAll('tspan'));
                        if (tName) tName.textContent = n.name;
                        if (tVal) {
                            tVal.setAttribute('x', x.toFixed(3));
                            tVal.textContent = formatTrillions(n.value);
                        }
                    }

                    if (t < 1) {
                        requestAnimationFrame(tick);
                    } else {
                        this.prev = next;
                    }
                };

                requestAnimationFrame(tick);
            }
        }

        function updateSankeyDiagram(impacts, opts = {}) {
            const svg = document.getElementById('sankey-diagram');
            if (!svg) return;

            const width = 800;
            const height = 400;

            if (!sankeyRenderer) {
                sankeyRenderer = new SankeyRenderer(svg);
            }

            const model = buildSankeyModel(impacts, getVizParams());
            const layout = computeSankeyLayout(model, width, height);
            const animate = opts.animate !== false;
            if (animate) {
                sankeyRenderer.animateTo(layout, 700);
            } else {
                sankeyRenderer.applyLayout(layout);
                sankeyRenderer.prev = layout;
            }
        }

        // --- World map (Canvas) ---
        let worldMapRenderer = null;

        function cssVar(name, fallback = '') {
            const v = getComputedStyle(document.documentElement).getPropertyValue(name).trim();
            return v || fallback;
        }

        function parseColorToRGB(input) {
            const s = (input || '').trim();
            if (!s) return { r: 0, g: 0, b: 0 };

            if (s.startsWith('#')) {
                const hex = s.slice(1);
                if (hex.length === 3) {
                    const r = parseInt(hex[0] + hex[0], 16);
                    const g = parseInt(hex[1] + hex[1], 16);
                    const b = parseInt(hex[2] + hex[2], 16);
                    return { r, g, b };
                }
                if (hex.length >= 6) {
                    const r = parseInt(hex.slice(0, 2), 16);
                    const g = parseInt(hex.slice(2, 4), 16);
                    const b = parseInt(hex.slice(4, 6), 16);
                    return { r, g, b };
                }
            }

            const rgbMatch = s.match(/rgba?\(([^)]+)\)/i);
            if (rgbMatch) {
                const parts = rgbMatch[1].split(',').map(p => p.trim());
                const r = parseFloat(parts[0]) || 0;
                const g = parseFloat(parts[1]) || 0;
                const b = parseFloat(parts[2]) || 0;
                return { r, g, b };
            }

            // Fall back by letting the browser resolve named colors.
            const tmp = document.createElement('div');
            tmp.style.color = s;
            document.body.appendChild(tmp);
            const resolved = getComputedStyle(tmp).color;
            document.body.removeChild(tmp);
            return parseColorToRGB(resolved);
        }

        function rgbToRgba(rgb, a = 1) {
            const r = Math.round(clamp(rgb.r, 0, 255));
            const g = Math.round(clamp(rgb.g, 0, 255));
            const b = Math.round(clamp(rgb.b, 0, 255));
            return `rgba(${r},${g},${b},${clamp(a, 0, 1)})`;
        }

        function mixRGB(a, b, t) {
            const tt = clamp(t, 0, 1);
            return {
                r: lerp(a.r, b.r, tt),
                g: lerp(a.g, b.g, tt),
                b: lerp(a.b, b.b, tt)
            };
        }

        const WORLD_REGIONS = [
            {
                id: 'na',
                name: 'North America',
                points: [
                    [-168, 72], [-150, 62], [-140, 55], [-125, 50], [-120, 38], [-110, 30],
                    [-100, 20], [-85, 15], [-60, 20], [-52, 50], [-75, 72], [-168, 72]
                ],
                label: [-105, 45],
                baseAdoption: 1.15,
                regulationSensitivity: 0.85,
                exposure: { transport: 0.85, supply: 0.70, realestate: 0.70, energy: 0.55, labor: 0.65, military: 0.65, space: 0.75 }
            },
            {
                id: 'sa',
                name: 'South America',
                points: [
                    [-82, 12], [-35, 12], [-30, -10], [-45, -35], [-60, -55], [-75, -40], [-82, -10], [-82, 12]
                ],
                label: [-60, -15],
                baseAdoption: 0.78,
                regulationSensitivity: 0.95,
                exposure: { transport: 0.70, supply: 0.60, realestate: 0.55, energy: 0.60, labor: 0.55, military: 0.35, space: 0.35 }
            },
            {
                id: 'eu',
                name: 'Europe',
                points: [
                    [-11, 36], [5, 36], [25, 40], [35, 52], [40, 60], [10, 72], [-10, 60], [-11, 36]
                ],
                label: [15, 52],
                baseAdoption: 1.00,
                regulationSensitivity: 1.25,
                exposure: { transport: 0.75, supply: 0.65, realestate: 0.70, energy: 0.50, labor: 0.65, military: 0.45, space: 0.55 }
            },
            {
                id: 'af',
                name: 'Africa',
                points: [
                    [-20, 35], [10, 35], [35, 30], [50, 10], [52, -10], [40, -35], [10, -35], [-20, 0], [-20, 35]
                ],
                label: [18, 2],
                baseAdoption: 0.58,
                regulationSensitivity: 0.85,
                exposure: { transport: 0.65, supply: 0.55, realestate: 0.50, energy: 0.70, labor: 0.60, military: 0.35, space: 0.30 }
            },
            {
                id: 'as',
                name: 'Asia',
                points: [
                    [35, 5], [55, 5], [70, 12], [80, 5], [95, 5], [110, 10], [125, 8], [150, 0],
                    [170, 20], [170, 55], [140, 70], [90, 75], [60, 70], [45, 55], [35, 35], [35, 5]
                ],
                label: [95, 35],
                baseAdoption: 1.12,
                regulationSensitivity: 0.90,
                exposure: { transport: 0.85, supply: 0.90, realestate: 0.60, energy: 0.55, labor: 0.70, military: 0.55, space: 0.55 }
            },
            {
                id: 'oc',
                name: 'Oceania',
                points: [
                    [110, -10], [140, -10], [155, -20], [170, -30], [155, -50], [120, -45], [110, -30], [110, -10]
                ],
                label: [140, -28],
                baseAdoption: 0.88,
                regulationSensitivity: 1.00,
                exposure: { transport: 0.70, supply: 0.55, realestate: 0.55, energy: 0.45, labor: 0.50, military: 0.40, space: 0.45 }
            }
        ];

        function calculateRegionalMetrics(impacts, params) {
            const p = adoptionProgressAtYear(params.timelineYear ?? 10, params);
            const regulation = clamp((params.regulation ?? 50) / 100, 0, 1);

            const contextBoost = {
                government: { na: 0.06, eu: 0.03, as: 0.01, oc: 0.01, af: 0.00, sa: 0.00 },
                corporation: { na: 0.05, as: 0.04, eu: 0.02, oc: 0.01, af: 0.00, sa: 0.01 },
                individual: { eu: 0.04, na: 0.02, as: 0.02, oc: 0.01, af: 0.01, sa: 0.01 },
                accident: { na: 0.02, eu: 0.01, as: 0.01, oc: 0.00, af: 0.00, sa: 0.00 }
            }[params.discoveryContext] || {};

            return WORLD_REGIONS.map(r => {
                const regPenalty = (regulation - 0.5) * 0.30 * r.regulationSensitivity;
                const adoption = clamp(p * r.baseAdoption * (1 - regPenalty) + (contextBoost[r.id] || 0), 0, 1);

                const ex = r.exposure;
                const weights = Object.values(ex).reduce((a, b) => a + b, 0) || 1;
                const shockRaw =
                    (ex.transport * (impacts.transport ?? 0) +
                        ex.supply * (impacts.supply ?? 0) +
                        ex.realestate * (impacts.realestate ?? 0) +
                        ex.energy * (impacts.energy ?? 0) +
                        ex.labor * (impacts.labor ?? 0) +
                        ex.military * (impacts.military ?? 0) +
                        ex.space * (impacts.space ?? 0)) / weights;

                const shock = clamp((shockRaw / 100) * (0.55 + 0.45 * adoption), 0, 1);

                return {
                    id: r.id,
                    name: r.name,
                    adoption,
                    shock
                };
            });
        }

        class WorldMapRenderer {
            constructor(canvas) {
                this.canvas = canvas;
                this.ctx = canvas.getContext('2d', { alpha: true, desynchronized: true });
                this.prev = null;
                this.colors = this.readPalette();
            }

            readPalette() {
                const parchment = parseColorToRGB(cssVar('--parchment', '#f4e4bc'));
                const ink = parseColorToRGB(cssVar('--ink', '#2c1810'));
                const inkFaded = parseColorToRGB(cssVar('--ink-faded', '#4a3828'));
                const stampRed = parseColorToRGB(cssVar('--stamp-red', '#8b0000'));
                const ocean = parseColorToRGB(cssVar('--flow-transport', '#4a7c9b'));
                return { parchment, ink, inkFaded, stampRed, ocean };
            }

            resizeToDisplaySize() {
                const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
                const rect = this.canvas.getBoundingClientRect();
                const w = Math.max(320, Math.round(rect.width));
                const h = Math.max(240, Math.round(rect.height));
                const nextW = Math.round(w * dpr);
                const nextH = Math.round(h * dpr);
                if (this.canvas.width !== nextW || this.canvas.height !== nextH) {
                    this.canvas.width = nextW;
                    this.canvas.height = nextH;
                }
                return { w, h, dpr };
            }

            project(lon, lat, w, h) {
                const x = ((lon + 180) / 360) * w;
                const y = ((90 - lat) / 180) * h;
                return { x, y };
            }

            drawRegionPath(region, w, h) {
                const ctx = this.ctx;
                ctx.beginPath();
                region.points.forEach((p, idx) => {
                    const pt = this.project(p[0], p[1], w, h);
                    if (idx === 0) ctx.moveTo(pt.x, pt.y);
                    else ctx.lineTo(pt.x, pt.y);
                });
                ctx.closePath();
            }

            drawGraticule(w, h) {
                const ctx = this.ctx;
                ctx.save();
                ctx.lineWidth = 1;
                ctx.strokeStyle = rgbToRgba(this.colors.ink, 0.06);
                ctx.setLineDash([2, 6]);

                for (let lon = -150; lon <= 150; lon += 30) {
                    const x = ((lon + 180) / 360) * w;
                    ctx.beginPath();
                    ctx.moveTo(x, 0);
                    ctx.lineTo(x, h);
                    ctx.stroke();
                }

                for (let lat = -60; lat <= 60; lat += 30) {
                    const y = ((90 - lat) / 180) * h;
                    ctx.beginPath();
                    ctx.moveTo(0, y);
                    ctx.lineTo(w, y);
                    ctx.stroke();
                }

                ctx.restore();
            }

            drawCompassRose(w, h) {
                const ctx = this.ctx;
                ctx.save();
                const x = w - 58;
                const y = 54;
                ctx.translate(x, y);
                ctx.strokeStyle = rgbToRgba(this.colors.ink, 0.55);
                ctx.fillStyle = rgbToRgba(this.colors.ink, 0.08);
                ctx.lineWidth = 1;
                ctx.beginPath();
                ctx.arc(0, 0, 18, 0, Math.PI * 2);
                ctx.fill();
                ctx.stroke();
                ctx.beginPath();
                ctx.moveTo(0, -20);
                ctx.lineTo(0, 20);
                ctx.moveTo(-20, 0);
                ctx.lineTo(20, 0);
                ctx.stroke();
                ctx.fillStyle = rgbToRgba(this.colors.ink, 0.7);
                ctx.font = '10px "Berkeley Mono", "Courier New", monospace';
                ctx.textAlign = 'center';
                ctx.textBaseline = 'bottom';
                ctx.fillText('N', 0, -24);
                ctx.restore();
            }

            render(data) {
                const { w, h, dpr } = this.resizeToDisplaySize();
                const ctx = this.ctx;
                ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

                // Background wash
                ctx.clearRect(0, 0, w, h);
                ctx.fillStyle = rgbToRgba(this.colors.parchment, 0.20);
                ctx.fillRect(0, 0, w, h);

                this.drawGraticule(w, h);

                // Ocean tint (very subtle)
                ctx.fillStyle = rgbToRgba(this.colors.ocean, 0.06);
                ctx.fillRect(0, 0, w, h);

                // Region fills + outlines
                const regionById = Object.fromEntries(data.map(d => [d.id, d]));

                for (const region of WORLD_REGIONS) {
                    const m = regionById[region.id] || { adoption: 0, shock: 0 };
                    const adopt = clamp(m.adoption, 0, 1);
                    const shock = clamp(m.shock, 0, 1);

                    const fill = mixRGB(this.colors.parchment, this.colors.ocean, 0.15 + 0.75 * adopt);

                    this.drawRegionPath(region, w, h);
                    ctx.fillStyle = rgbToRgba(fill, 0.90);
                    ctx.fill();

                    ctx.lineWidth = 1.25;
                    ctx.strokeStyle = rgbToRgba(this.colors.ink, 0.35);
                    ctx.stroke();

                    // Impact hatching
                    if (shock > 0.02) {
                        ctx.save();
                        this.drawRegionPath(region, w, h);
                        ctx.clip();
                        const spacing = lerp(28, 8, shock);
                        ctx.lineWidth = 1;
                        ctx.strokeStyle = rgbToRgba(this.colors.stampRed, 0.10 + 0.22 * shock);
                        ctx.beginPath();
                        for (let x = -h; x < w + h; x += spacing) {
                            ctx.moveTo(x, 0);
                            ctx.lineTo(x + h, h);
                        }
                        ctx.stroke();
                        ctx.restore();
                    }

                    // Labels
                    const labelLonLat = region.label || region.points[Math.floor(region.points.length / 2)];
                    const labelPt = this.project(labelLonLat[0], labelLonLat[1], w, h);
                    ctx.fillStyle = rgbToRgba(this.colors.ink, 0.85);
                    ctx.font = 'bold 11px "Berkeley Mono", "Courier New", monospace';
                    ctx.textAlign = 'center';
                    ctx.textBaseline = 'middle';
                    ctx.fillText(region.name.toUpperCase(), labelPt.x, labelPt.y - 10);
                    ctx.font = '10px "Berkeley Mono", "Courier New", monospace';
                    ctx.fillStyle = rgbToRgba(this.colors.inkFaded, 0.95);
                    ctx.fillText(`${Math.round(adopt * 100)}% • ${Math.round(shock * 100)}%`, labelPt.x, labelPt.y + 8);
                }

                // Frame
                ctx.lineWidth = 2;
                ctx.strokeStyle = rgbToRgba(this.colors.ink, 0.35);
                ctx.strokeRect(1, 1, w - 2, h - 2);

                // Decorative corner marks
                ctx.save();
                ctx.strokeStyle = rgbToRgba(this.colors.ink, 0.25);
                ctx.lineWidth = 1;
                const corner = 18;
                const inset = 6;
                ctx.beginPath();
                // TL
                ctx.moveTo(inset, inset + corner);
                ctx.lineTo(inset, inset);
                ctx.lineTo(inset + corner, inset);
                // TR
                ctx.moveTo(w - inset - corner, inset);
                ctx.lineTo(w - inset, inset);
                ctx.lineTo(w - inset, inset + corner);
                // BL
                ctx.moveTo(inset, h - inset - corner);
                ctx.lineTo(inset, h - inset);
                ctx.lineTo(inset + corner, h - inset);
                // BR
                ctx.moveTo(w - inset - corner, h - inset);
                ctx.lineTo(w - inset, h - inset);
                ctx.lineTo(w - inset, h - inset - corner);
                ctx.stroke();
                ctx.restore();

                this.drawCompassRose(w, h);
            }

            animateTo(next, durationMs = 650) {
                const reduced = prefersReducedMotion();
                if (!this.prev || reduced || durationMs <= 0) {
                    this.render(next);
                    this.prev = next;
                    return;
                }

                const prevById = Object.fromEntries(this.prev.map(d => [d.id, d]));
                const nextById = Object.fromEntries(next.map(d => [d.id, d]));

                const start = performance.now();
                const tick = (now) => {
                    const t = clamp((now - start) / durationMs, 0, 1);
                    const e = easeInOutCubic(t);

                    const blended = WORLD_REGIONS.map(r => {
                        const a = prevById[r.id] || { adoption: 0, shock: 0 };
                        const b = nextById[r.id] || { adoption: 0, shock: 0 };
                        return {
                            id: r.id,
                            name: r.name,
                            adoption: lerp(a.adoption, b.adoption, e),
                            shock: lerp(a.shock, b.shock, e)
                        };
                    });

                    this.render(blended);
                    if (t < 1) {
                        requestAnimationFrame(tick);
                    } else {
                        this.prev = next;
                    }
                };
                requestAnimationFrame(tick);
            }
        }

        function updateWorldMap(impacts, opts = {}) {
            const canvas = document.getElementById('world-map');
            if (!canvas) return;

            if (!worldMapRenderer) {
                worldMapRenderer = new WorldMapRenderer(canvas);
            }

            const params = getVizParams();
            const metrics = calculateRegionalMetrics(impacts, params);
            const animate = opts.animate !== false;
            worldMapRenderer.animateTo(metrics, animate ? 650 : 0);

            const caption = document.getElementById('map-caption');
            if (caption) {
                caption.textContent = `Adoption fills; impact hatching. Year ${params.timelineYear}.`;
            }

            const readout = document.getElementById('region-readout');
            if (readout) {
                readout.innerHTML = metrics
                    .slice()
                    .sort((a, b) => b.adoption - a.adoption)
                    .map(m => {
                        const adopt = Math.round(m.adoption * 100);
                        const shock = Math.round(m.shock * 100);
                        return `
                            <div class="region-row">
                                <div>
                                    <div class="region-name">${m.name}</div>
                                    <div class="region-metrics">ADOPTION ${adopt}% • SHOCK ${shock}%</div>
                                </div>
                                <div class="region-metrics">Y${params.timelineYear}</div>
                            </div>
                        `;
                    })
                    .join('');
            }
        }

        // --- Sparklines (Canvas) ---
        const SPARKLINE_SERIES = {
            containerization: { mid: 0.46, k: 10.5, colorVar: '--flow-supply' },
            internet: { mid: 0.55, k: 12.0, colorVar: '--flow-transport' }
        };

        function logistic(x, mid, k) {
            return 1 / (1 + Math.exp(-k * (x - mid)));
        }

        function generateSeries({ points = 64, mid = 0.5, k = 10 }) {
            const out = [];
            for (let i = 0; i < points; i++) {
                const x = i / (points - 1);
                out.push(clamp(logistic(x, mid, k), 0, 1));
            }
            return out;
        }

        function resizeCanvasToCSSPixels(canvas) {
            const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));
            const rect = canvas.getBoundingClientRect();
            const w = Math.max(200, Math.round(rect.width));
            const h = Math.max(60, Math.round(rect.height));
            const nextW = Math.round(w * dpr);
            const nextH = Math.round(h * dpr);
            if (canvas.width !== nextW || canvas.height !== nextH) {
                canvas.width = nextW;
                canvas.height = nextH;
            }
            return { w, h, dpr };
        }

        function drawSparkline(canvas, series, opts = {}) {
            const ctx = canvas.getContext('2d', { alpha: true, desynchronized: true });
            const { w, h, dpr } = resizeCanvasToCSSPixels(canvas);
            ctx.setTransform(dpr, 0, 0, dpr, 0, 0);

            const ink = parseColorToRGB(cssVar('--ink', '#2c1810'));
            const inkFaded = parseColorToRGB(cssVar('--ink-faded', '#4a3828'));
            const parchment = parseColorToRGB(cssVar('--parchment', '#f4e4bc'));
            const accent = parseColorToRGB(cssVar(opts.colorVar || '--flow-supply', '#3d7c6b'));

            ctx.clearRect(0, 0, w, h);
            ctx.fillStyle = rgbToRgba(parchment, 0.14);
            ctx.fillRect(0, 0, w, h);

            const pad = 10;
            const innerW = w - pad * 2;
            const innerH = h - pad * 2;

            // Midline + baseline
            ctx.save();
            ctx.strokeStyle = rgbToRgba(inkFaded, 0.22);
            ctx.lineWidth = 1;
            ctx.setLineDash([3, 5]);
            ctx.beginPath();
            ctx.moveTo(pad, pad + innerH * 0.5);
            ctx.lineTo(pad + innerW, pad + innerH * 0.5);
            ctx.stroke();
            ctx.setLineDash([]);
            ctx.restore();

            // Curve points
            const pts = series.map((y, i) => {
                const x = pad + (i / (series.length - 1)) * innerW;
                const yy = pad + (1 - clamp(y, 0, 1)) * innerH;
                return { x, y: yy, v: y };
            });

            // Area fill
            ctx.save();
            ctx.beginPath();
            ctx.moveTo(pts[0].x, pad + innerH);
            for (const p of pts) ctx.lineTo(p.x, p.y);
            ctx.lineTo(pts[pts.length - 1].x, pad + innerH);
            ctx.closePath();
            ctx.fillStyle = rgbToRgba(accent, 0.12);
            ctx.fill();
            ctx.restore();

            // Curve stroke
            ctx.save();
            ctx.beginPath();
            ctx.moveTo(pts[0].x, pts[0].y);
            for (let i = 1; i < pts.length; i++) ctx.lineTo(pts[i].x, pts[i].y);
            ctx.strokeStyle = rgbToRgba(accent, 0.85);
            ctx.lineWidth = 2;
            ctx.stroke();
            ctx.restore();

            // Inflection marker
            if (Number.isFinite(opts.mid)) {
                const mx = pad + clamp(opts.mid, 0, 1) * innerW;
                ctx.save();
                ctx.strokeStyle = rgbToRgba(ink, 0.35);
                ctx.lineWidth = 1;
                ctx.setLineDash([2, 4]);
                ctx.beginPath();
                ctx.moveTo(mx, pad);
                ctx.lineTo(mx, pad + innerH);
                ctx.stroke();
                ctx.restore();
            }

            // Border
            ctx.save();
            ctx.strokeStyle = rgbToRgba(ink, 0.18);
            ctx.lineWidth = 1;
            ctx.strokeRect(0.5, 0.5, w - 1, h - 1);
            ctx.restore();
        }

        function renderSparklines() {
            const c1 = document.getElementById('spark-containerization');
            const c2 = document.getElementById('spark-internet');
            if (c1) {
                const spec = SPARKLINE_SERIES.containerization;
                drawSparkline(
                    c1,
                    generateSeries({ points: 72, mid: spec.mid, k: spec.k }),
                    { colorVar: spec.colorVar, mid: spec.mid }
                );
            }
            if (c2) {
                const spec = SPARKLINE_SERIES.internet;
                drawSparkline(
                    c2,
                    generateSeries({ points: 72, mid: spec.mid, k: spec.k }),
                    { colorVar: spec.colorVar, mid: spec.mid }
                );
            }
        }

        // --- Cascade timeline (SVG) ---
        let cascadeTimelineRenderer = null;

        const TIMELINE_LANES = [
            { id: 'tech', label: 'TECH' },
            { id: 'markets', label: 'MARKETS' },
            { id: 'infra', label: 'INFRA' },
            { id: 'society', label: 'SOCIETY' },
            { id: 'geo', label: 'GEO' },
            { id: 'space', label: 'SPACE' }
        ];

        function computeTimelineAnchors(params) {
            const adoptionYears = clamp(params.adoptionRate ?? 20, 1, 100);
            const regulation = (params.regulation ?? 50);
            const energy = (params.energyCost ?? 50);
            const payload = (params.payload ?? 60);

            const ctxShift = {
                government: { commercial: 0.8, market: 1.2, space: -0.6 },
                corporation: { commercial: -1.2, market: -0.2, space: 0.3 },
                individual: { commercial: 0.3, market: 0.6, space: 0.5 },
                accident: { commercial: 0.2, market: 0.8, space: 0.0 }
            }[params.discoveryContext] || { commercial: 0, market: 0, space: 0 };

            const speedShift =
                ((regulation - 50) / 100) * 3
                + ((energy - 50) / 100) * 2
                - ((payload - 50) / 100) * 2;

            let patent = 1;
            let commercial = adoptionYears * 0.25 + speedShift * 0.6 + ctxShift.commercial;
            let mass = adoptionYears * 0.50 + speedShift * 0.45;
            let collapse = adoptionYears * 0.75 + speedShift * 0.35;
            let transform = adoptionYears * 1.00 + speedShift * 0.25;
            let equilibrium = adoptionYears * 1.50 + speedShift * 0.15;

            // enforce monotonic spacing
            commercial = Math.max(commercial, patent + 1);
            mass = Math.max(mass, commercial + 2);
            collapse = Math.max(collapse, mass + 2);
            transform = Math.max(transform, collapse + 2);
            equilibrium = Math.max(equilibrium, transform + 4);

            return {
                patent,
                commercial,
                mass,
                collapse,
                transform,
                equilibrium,
                ctxShift
            };
        }

        function computeCascadeEvents(impacts, params) {
            const anchors = computeTimelineAnchors(params);
            const regulation = clamp((params.regulation ?? 50) / 100, 0, 1);
            const payload = clamp((params.payload ?? 60) / 100, 0, 1);

            const d = {
                transport: clamp((impacts.transport ?? 0) / 100, 0, 1),
                supply: clamp((impacts.supply ?? 0) / 100, 0, 1),
                energy: clamp((impacts.energy ?? 0) / 100, 0, 1),
                labor: clamp((impacts.labor ?? 0) / 100, 0, 1),
                realestate: clamp((impacts.realestate ?? 0) / 100, 0, 1),
                urban: clamp((impacts.urban ?? 0) / 100, 0, 1),
                military: clamp((impacts.military ?? 0) / 100, 0, 1),
                space: clamp((impacts.space ?? 0) / 100, 0, 1)
            };

            const yBankruptcy = anchors.commercial + lerp(7, 2, d.transport) + lerp(1.2, -0.6, 1 - regulation) + anchors.ctxShift.market;
            const yOilCrash = anchors.commercial + lerp(9, 2.5, d.energy) + lerp(1.0, -0.8, 1 - regulation);
            const yPortStrand = anchors.mass + lerp(4.5, 1.5, d.supply);
            const yAirspace = anchors.commercial + lerp(4.5, 1.5, d.transport) + lerp(-0.4, 1.2, regulation);
            const yTreaty = anchors.mass + lerp(10, 3.5, regulation) + lerp(1.2, -0.6, d.military);
            const yCarrier = anchors.collapse + lerp(6, 2, d.military);
            const yLaborShock = anchors.collapse + lerp(8, 2.5, d.labor) + lerp(1.0, -0.8, regulation);
            const yFloatingCity = anchors.collapse + lerp(10, 3.0, (d.urban + d.realestate) / 2);
            const yOrbitalYard = anchors.mass + lerp(12, 3.5, d.space * payload);
            const yMoonBase = yOrbitalYard + lerp(10, 3.0, d.space);

            const events = [
                {
                    id: 'patent',
                    lane: 'tech',
                    label: 'First Patent',
                    year: anchors.patent,
                    severity: 0.25,
                    color: 'var(--ink)'
                },
                {
                    id: 'commercial',
                    lane: 'tech',
                    label: 'First Commercial Platform',
                    year: anchors.commercial,
                    severity: 0.45,
                    color: 'var(--flow-transport)',
                    dependsOn: ['patent']
                },
                {
                    id: 'bankruptcy',
                    lane: 'markets',
                    label: 'First Major Bankruptcy',
                    year: yBankruptcy,
                    severity: 0.55 + 0.25 * d.transport,
                    color: 'var(--stamp-red)',
                    dependsOn: ['commercial']
                },
                {
                    id: 'oilCrash',
                    lane: 'markets',
                    label: 'Fuel Market Collapse',
                    year: yOilCrash,
                    severity: 0.45 + 0.35 * d.energy,
                    color: 'var(--flow-energy)',
                    dependsOn: ['commercial']
                },
                {
                    id: 'airspace',
                    lane: 'geo',
                    label: 'Airspace Clampdown',
                    year: yAirspace,
                    severity: 0.35 + 0.35 * regulation,
                    color: 'var(--flow-military)',
                    dependsOn: ['commercial']
                },
                {
                    id: 'mass',
                    lane: 'tech',
                    label: 'Mass Adoption',
                    year: anchors.mass,
                    severity: 0.55,
                    color: 'var(--flow-supply)',
                    dependsOn: ['commercial']
                },
                {
                    id: 'ports',
                    lane: 'infra',
                    label: 'Port Infrastructure Strands',
                    year: yPortStrand,
                    severity: 0.35 + 0.35 * d.supply,
                    color: 'var(--flow-supply)',
                    dependsOn: ['mass']
                },
                {
                    id: 'collapse',
                    lane: 'markets',
                    label: 'Transport Collapse',
                    year: anchors.collapse,
                    severity: 0.65 + 0.25 * d.transport,
                    color: 'var(--flow-transport)',
                    dependsOn: ['mass', 'bankruptcy']
                },
                {
                    id: 'labor',
                    lane: 'society',
                    label: 'Labor Displacement Wave',
                    year: yLaborShock,
                    severity: 0.55 + 0.30 * d.labor,
                    color: 'var(--flow-labor)',
                    dependsOn: ['collapse', 'bankruptcy']
                },
                {
                    id: 'floatingCity',
                    lane: 'infra',
                    label: 'First Floating City',
                    year: yFloatingCity,
                    severity: 0.45 + 0.30 * ((d.urban + d.realestate) / 2),
                    color: 'var(--flow-urban)',
                    dependsOn: ['collapse']
                },
                {
                    id: 'treaty',
                    lane: 'geo',
                    label: 'First Global Treaty',
                    year: yTreaty,
                    severity: 0.40 + 0.30 * regulation,
                    color: 'var(--ink-faded)',
                    dependsOn: ['airspace', 'mass']
                },
                {
                    id: 'carrier',
                    lane: 'geo',
                    label: 'Carrier Doctrine Obsolete',
                    year: yCarrier,
                    severity: 0.45 + 0.35 * d.military,
                    color: 'var(--flow-military)',
                    dependsOn: ['airspace', 'collapse']
                },
                {
                    id: 'transform',
                    lane: 'markets',
                    label: 'Full Transformation',
                    year: anchors.transform,
                    severity: 0.65,
                    color: 'var(--ink)',
                    dependsOn: ['collapse', 'floatingCity', 'treaty']
                },
                {
                    id: 'yard',
                    lane: 'space',
                    label: 'First Orbital Shipyard',
                    year: yOrbitalYard,
                    severity: 0.45 + 0.40 * d.space,
                    color: 'var(--flow-space)',
                    dependsOn: ['mass']
                },
                {
                    id: 'moon',
                    lane: 'space',
                    label: 'First Lunar Base',
                    year: yMoonBase,
                    severity: 0.35 + 0.45 * d.space,
                    color: 'var(--flow-space)',
                    dependsOn: ['yard']
                },
                {
                    id: 'equilibrium',
                    lane: 'society',
                    label: 'New Equilibrium',
                    year: anchors.equilibrium,
                    severity: 0.50,
                    color: 'var(--ink-faded)',
                    dependsOn: ['transform', 'labor', 'moon']
                }
            ];

            // Normalize + clamp display years for timeline horizon (0..TIMELINE_HORIZON)
            for (const e of events) {
                const actual = Number.isFinite(e.year) ? e.year : TIMELINE_HORIZON;
                e.year = Math.max(0, actual);
                e.displayYear = clamp(e.year, 0, TIMELINE_HORIZON);
                e.outOfHorizon = e.year > TIMELINE_HORIZON;
                e.dependsOn = e.dependsOn || [];
            }

            return events;
        }

        function computeTimelineLayout(events, width, height, params) {
            const margin = { top: 24, right: 18, bottom: 24, left: 84 };
            const axisY = height - margin.bottom + 2;
            const x0 = margin.left;
            const x1 = width - margin.right;
            const y0 = margin.top;
            const y1 = height - margin.bottom - 6;
            const laneGap = (TIMELINE_LANES.length <= 1) ? 0 : (y1 - y0) / (TIMELINE_LANES.length - 1);
            const laneY = Object.fromEntries(TIMELINE_LANES.map((l, i) => [l.id, y0 + i * laneGap]));

            const xAtYear = (yr) => lerp(x0, x1, clamp(yr / TIMELINE_HORIZON, 0, 1));

            const laidEvents = events.map(e => {
                const y = laneY[e.lane] ?? (y0 + y1) / 2;
                return {
                    ...e,
                    x: xAtYear(e.displayYear),
                    y
                };
            });

            const eventById = Object.fromEntries(laidEvents.map(e => [e.id, e]));

            const edges = [];
            for (const e of laidEvents) {
                for (const dep of e.dependsOn) {
                    const from = eventById[dep];
                    const to = e;
                    if (!from) continue;
                    edges.push({
                        id: `${dep}→${e.id}`,
                        from: dep,
                        to: e.id,
                        x0: from.x,
                        y0: from.y,
                        x1: to.x,
                        y1: to.y
                    });
                }
            }

            const currentYear = clamp(params.timelineYear ?? 10, 0, TIMELINE_HORIZON);
            const currentX = xAtYear(currentYear);

            return {
                width,
                height,
                margin,
                axisY,
                x0,
                x1,
                laneY,
                events: laidEvents,
                edges,
                currentYear,
                currentX
            };
        }

        function connectorPath(edge) {
            const x0 = edge.x0;
            const y0 = edge.y0;
            const x1 = edge.x1;
            const y1 = edge.y1;
            const dx = Math.max(24, Math.abs(x1 - x0) * 0.45);
            const c1x = x0 + dx;
            const c2x = x1 - dx;
            return `M ${x0.toFixed(3)} ${y0.toFixed(3)} C ${c1x.toFixed(3)} ${y0.toFixed(3)}, ${c2x.toFixed(3)} ${y1.toFixed(3)}, ${x1.toFixed(3)} ${y1.toFixed(3)}`;
        }

        class CascadeTimelineRenderer {
            constructor(svg) {
                this.svg = svg;
                this.prev = null;
                this.eventEls = new Map();
                this.edgeEls = new Map();

                while (this.svg.firstChild) this.svg.removeChild(this.svg.firstChild);

                const defs = document.createElementNS(SVG_NS, 'defs');
                defs.innerHTML = `
                    <marker id="arrowInk" markerWidth="10" markerHeight="10" refX="8" refY="3" orient="auto" markerUnits="strokeWidth">
                        <path d="M 0 0 L 8 3 L 0 6 z" fill="rgba(44,24,16,0.35)"></path>
                    </marker>
                `;
                this.svg.appendChild(defs);

                this.gGrid = document.createElementNS(SVG_NS, 'g');
                this.gEdges = document.createElementNS(SVG_NS, 'g');
                this.gEvents = document.createElementNS(SVG_NS, 'g');
                this.gOverlay = document.createElementNS(SVG_NS, 'g');

                this.gGrid.setAttribute('opacity', '0.9');
                this.gEdges.setAttribute('opacity', '0.75');
                this.gEdges.setAttribute('style', 'mix-blend-mode:multiply');
                this.gOverlay.setAttribute('pointer-events', 'none');

                this.svg.appendChild(this.gGrid);
                this.svg.appendChild(this.gEdges);
                this.svg.appendChild(this.gEvents);
                this.svg.appendChild(this.gOverlay);

                this.currentLine = document.createElementNS(SVG_NS, 'line');
                this.currentLine.setAttribute('stroke', 'var(--stamp-red)');
                this.currentLine.setAttribute('stroke-width', '2');
                this.currentLine.setAttribute('stroke-opacity', '0.55');
                this.currentLine.setAttribute('y1', '0');
                this.currentLine.setAttribute('y2', '240');
                this.gOverlay.appendChild(this.currentLine);

                this.currentLabel = document.createElementNS(SVG_NS, 'text');
                this.currentLabel.setAttribute('fill', 'var(--stamp-red)');
                this.currentLabel.setAttribute('font-family', "'Berkeley Mono', 'Courier New', monospace");
                this.currentLabel.setAttribute('font-size', '10');
                this.currentLabel.setAttribute('font-weight', 'bold');
                this.currentLabel.setAttribute('text-anchor', 'middle');
                this.currentLabel.setAttribute('y', '14');
                this.gOverlay.appendChild(this.currentLabel);
            }

            drawStatic(layout) {
                if (this._staticDrawn) return;
                this._staticDrawn = true;

                const width = layout.width;
                const height = layout.height;

                // Year grid lines + labels
                for (let yr = 0; yr <= TIMELINE_HORIZON; yr += 10) {
                    const x = lerp(layout.x0, layout.x1, yr / TIMELINE_HORIZON);
                    const line = document.createElementNS(SVG_NS, 'line');
                    line.setAttribute('x1', x.toFixed(3));
                    line.setAttribute('x2', x.toFixed(3));
                    line.setAttribute('y1', '16');
                    line.setAttribute('y2', (height - 18).toFixed(3));
                    line.setAttribute('stroke', 'rgba(44,24,16,0.07)');
                    line.setAttribute('stroke-width', '1');
                    this.gGrid.appendChild(line);

                    const label = document.createElementNS(SVG_NS, 'text');
                    label.setAttribute('x', x.toFixed(3));
                    label.setAttribute('y', (height - 8).toFixed(3));
                    label.setAttribute('fill', 'var(--ink-faded)');
                    label.setAttribute('font-family', "'Berkeley Mono', 'Courier New', monospace");
                    label.setAttribute('font-size', '10');
                    label.setAttribute('text-anchor', 'middle');
                    label.textContent = `Y${yr}`;
                    this.gGrid.appendChild(label);
                }

                // Lanes
                for (const lane of TIMELINE_LANES) {
                    const y = layout.laneY[lane.id];
                    const yStr = y.toFixed(3);
                    const l = document.createElementNS(SVG_NS, 'line');
                    l.setAttribute('x1', layout.x0.toFixed(3));
                    l.setAttribute('x2', layout.x1.toFixed(3));
                    l.setAttribute('y1', yStr);
                    l.setAttribute('y2', yStr);
                    l.setAttribute('stroke', 'rgba(44,24,16,0.16)');
                    l.setAttribute('stroke-width', '1');
                    l.setAttribute('stroke-dasharray', '2 6');
                    this.gGrid.appendChild(l);

                    const t = document.createElementNS(SVG_NS, 'text');
                    t.setAttribute('x', (layout.x0 - 10).toFixed(3));
                    t.setAttribute('y', yStr);
                    t.setAttribute('fill', 'var(--ink-faded)');
                    t.setAttribute('font-family', "'Berkeley Mono', 'Courier New', monospace");
                    t.setAttribute('font-size', '10');
                    t.setAttribute('text-anchor', 'end');
                    t.setAttribute('dominant-baseline', 'middle');
                    t.textContent = lane.label;
                    this.gGrid.appendChild(t);
                }
            }

            ensureEdge(id) {
                let el = this.edgeEls.get(id);
                if (!el) {
                    el = document.createElementNS(SVG_NS, 'path');
                    el.setAttribute('fill', 'none');
                    el.setAttribute('stroke', 'rgba(44,24,16,0.28)');
                    el.setAttribute('stroke-width', '1.25');
                    el.setAttribute('marker-end', 'url(#arrowInk)');
                    el.setAttribute('stroke-linecap', 'round');
                    el.setAttribute('stroke-linejoin', 'round');
                    this.gEdges.appendChild(el);
                    this.edgeEls.set(id, el);
                }
                return el;
            }

            ensureEvent(id) {
                let g = this.eventEls.get(id);
                if (!g) {
                    g = document.createElementNS(SVG_NS, 'g');
                    g.setAttribute('data-id', id);

                    const dot = document.createElementNS(SVG_NS, 'circle');
                    dot.setAttribute('r', '5');
                    dot.setAttribute('stroke', 'rgba(44,24,16,0.55)');
                    dot.setAttribute('stroke-width', '1');
                    dot.setAttribute('vector-effect', 'non-scaling-stroke');
                    g.appendChild(dot);

                    const label = document.createElementNS(SVG_NS, 'text');
                    label.setAttribute('x', '8');
                    label.setAttribute('y', '-8');
                    label.setAttribute('fill', 'var(--ink)');
                    label.setAttribute('font-family', "'Berkeley Mono', 'Courier New', monospace");
                    label.setAttribute('font-size', '10');
                    label.setAttribute('font-weight', 'bold');
                    label.setAttribute('text-anchor', 'start');
                    label.setAttribute('dominant-baseline', 'baseline');
                    g.appendChild(label);

                    const sub = document.createElementNS(SVG_NS, 'text');
                    sub.setAttribute('x', '8');
                    sub.setAttribute('y', '6');
                    sub.setAttribute('fill', 'var(--ink-faded)');
                    sub.setAttribute('font-family', "'Berkeley Mono', 'Courier New', monospace");
                    sub.setAttribute('font-size', '9');
                    sub.setAttribute('text-anchor', 'start');
                    sub.setAttribute('dominant-baseline', 'hanging');
                    g.appendChild(sub);

                    const title = document.createElementNS(SVG_NS, 'title');
                    g.appendChild(title);

                    this.gEvents.appendChild(g);
                    this.eventEls.set(id, g);
                }
                return g;
            }

            applyLayout(layout) {
                this.drawStatic(layout);

                // Current year marker
                const x = layout.currentX.toFixed(3);
                this.currentLine.setAttribute('x1', x);
                this.currentLine.setAttribute('x2', x);
                this.currentLabel.setAttribute('x', x);
                this.currentLabel.textContent = `Y${layout.currentYear}`;

                // Edges
                for (const edge of layout.edges) {
                    const el = this.ensureEdge(edge.id);
                    el.setAttribute('d', connectorPath(edge));
                }

                // Events
                for (const e of layout.events) {
                    const g = this.ensureEvent(e.id);
                    g.setAttribute('transform', `translate(${e.x.toFixed(3)} ${e.y.toFixed(3)})`);

                    const [dot, label, sub] = Array.from(g.querySelectorAll('circle, text'));
                    const occurred = e.year <= layout.currentYear + 1e-6;
                    const severity = clamp(e.severity ?? 0.4, 0.2, 1);
                    const r = lerp(4, 9, severity);
                    dot.setAttribute('r', r.toFixed(2));
                    dot.setAttribute('fill', occurred ? e.color : 'transparent');
                    dot.setAttribute('fill-opacity', occurred ? '0.65' : '0');
                    dot.setAttribute('stroke', occurred ? 'rgba(44,24,16,0.55)' : 'rgba(44,24,16,0.35)');

                    label.textContent = e.label.toUpperCase();
                    sub.textContent = e.outOfHorizon ? `Y${Math.round(e.year)}+` : `Y${Math.round(e.year)}`;
                    label.setAttribute('fill', occurred ? 'var(--ink)' : 'var(--ink-faded)');

                    const title = g.querySelector('title');
                    if (title) {
                        title.textContent = `${e.label} (${e.outOfHorizon ? `Y${Math.round(e.year)}+` : `Y${Math.round(e.year)}`})`;
                    }

                    // Visual cue for "beyond horizon"
                    g.setAttribute('opacity', e.outOfHorizon ? '0.75' : '1');
                }
            }

            animateTo(next, durationMs = 650) {
                const reduced = prefersReducedMotion();
                if (!this.prev || reduced || durationMs <= 0) {
                    this.applyLayout(next);
                    this.prev = next;
                    return;
                }

                const prev = this.prev;
                const prevEventById = Object.fromEntries(prev.events.map(e => [e.id, e]));
                const prevEdgeById = Object.fromEntries(prev.edges.map(e => [e.id, e]));

                const start = performance.now();
                const tick = (now) => {
                    const t = clamp((now - start) / durationMs, 0, 1);
                    const eT = easeInOutCubic(t);

                    // Interpolate current year line
                    const cx = lerp(prev.currentX, next.currentX, eT);
                    const x = cx.toFixed(3);
                    this.currentLine.setAttribute('x1', x);
                    this.currentLine.setAttribute('x2', x);
                    this.currentLabel.setAttribute('x', x);
                    this.currentLabel.textContent = `Y${next.currentYear}`;

                    // Edges
                    for (const edge of next.edges) {
                        const a = prevEdgeById[edge.id] || edge;
                        const interp = {
                            ...edge,
                            x0: lerp(a.x0, edge.x0, eT),
                            y0: lerp(a.y0, edge.y0, eT),
                            x1: lerp(a.x1, edge.x1, eT),
                            y1: lerp(a.y1, edge.y1, eT)
                        };
                        const el = this.ensureEdge(edge.id);
                        el.setAttribute('d', connectorPath(interp));
                    }

                    // Events
                    for (const ev of next.events) {
                        const a = prevEventById[ev.id] || ev;
                        const xI = lerp(a.x, ev.x, eT);
                        const yI = lerp(a.y, ev.y, eT);
                        const g = this.ensureEvent(ev.id);
                        g.setAttribute('transform', `translate(${xI.toFixed(3)} ${yI.toFixed(3)})`);
                    }

                    if (t < 1) {
                        requestAnimationFrame(tick);
                    } else {
                        this.applyLayout(next);
                        this.prev = next;
                    }
                };
                requestAnimationFrame(tick);
            }
        }

        function updateCascadeTimeline(impacts, opts = {}) {
            const svg = document.getElementById('cascade-timeline');
            if (!svg) return;

            const width = 800;
            const height = 240;
            if (!cascadeTimelineRenderer) {
                cascadeTimelineRenderer = new CascadeTimelineRenderer(svg);
            }

            const params = getVizParams();
            const events = computeCascadeEvents(impacts, params);
            const layout = computeTimelineLayout(events, width, height, params);
            const animate = opts.animate !== false;
            if (animate) {
                cascadeTimelineRenderer.animateTo(layout, 650);
            } else {
                cascadeTimelineRenderer.applyLayout(layout);
                cascadeTimelineRenderer.prev = layout;
            }

            const notes = document.getElementById('timeline-notes');
            if (notes) {
                const now = layout.currentYear;
                const completed = events.filter(e => e.year <= now + 1e-6).sort((a, b) => b.year - a.year).slice(0, 6);
                const upcoming = events.filter(e => e.year > now + 1e-6).sort((a, b) => a.year - b.year).slice(0, 6);

                const renderList = (list) => list.map(e => `
                    <div class="event-line">
                        <div class="event-name">${e.label}</div>
                        <div class="event-year">${e.outOfHorizon ? `Y${Math.round(e.year)}+` : `Y${Math.round(e.year)}`}</div>
                    </div>
                `).join('') || '<div class="event-line"><div class="event-name">None</div><div class="event-year">—</div></div>';

                notes.innerHTML = `
                    <div class="notes-title">FIELD NOTES — YEAR ${layout.currentYear}</div>
                    <div class="notes-section">
                        <div class="notes-title">Completed</div>
                        ${renderList(completed)}
                    </div>
                    <div class="notes-section">
                        <div class="notes-title">Next</div>
                        ${renderList(upcoming)}
                    </div>
                `;
            }
        }

        // Parameter value labels
        const VALUE_LABELS = {
            energy: ['Free', 'Minimal', 'Low', 'Moderate', 'High', 'Very High', 'Prohibitive'],
            payload: ['Personal', 'Vehicle', 'Truck', 'Industrial', 'Ship', 'Massive', 'Unlimited'],
            regulation: ['Open', 'Light', 'Moderate', 'Controlled', 'Heavy', 'Restricted', 'Locked']
        };

        function getValueLabel(type, value) {
            const labels = VALUE_LABELS[type];
            if (!labels) return value;
            const index = Math.min(Math.floor(value / 100 * labels.length), labels.length - 1);
            return labels[index];
        }

        // --- Tabs + horizon scrubber ---
        let activeTab = 'economic';

        function syncTimelineUI() {
            const year = state.timelineYear;

            const yearEl = document.getElementById('timeline-year');
            if (yearEl) yearEl.textContent = year;

            const unitEl = document.getElementById('timeline-year-unit');
            if (unitEl) unitEl.textContent = year === 1 ? 'year' : 'years';

            document.querySelectorAll('.js-current-year').forEach(el => {
                el.textContent = year;
            });

            document.querySelectorAll('.horizon-marker').forEach(btn => {
                const btnYear = parseInt(btn.dataset.year);
                const isActive = btnYear === year;
                btn.classList.toggle('active', isActive);
                btn.setAttribute('aria-checked', isActive ? 'true' : 'false');
                btn.setAttribute('tabindex', isActive ? '0' : '-1');
            });
        }

        function setTimelineYear(nextYear, opts = {}) {
            const year = parseInt(nextYear);
            if (!Number.isFinite(year)) return;
            state.timelineYear = year;
            syncTimelineUI();
            filterSectionsByYear(year);
            if (opts.updateVisuals !== false) {
                updateTimeSliceVisuals({ animate: opts.animate ?? false });
            }
        }

        function setActiveTab(tab, opts = {}) {
            if (!tab) return;
            activeTab = tab;
            document.body.dataset.activeTab = tab;

            document.querySelectorAll('.folder-tab[role="tab"]').forEach(btn => {
                const isActive = btn.dataset.tab === tab;
                btn.classList.toggle('active', isActive);
                btn.setAttribute('aria-selected', isActive ? 'true' : 'false');
                btn.setAttribute('tabindex', isActive ? '0' : '-1');
            });

            document.querySelectorAll('.tab-panel[role="tabpanel"]').forEach(panel => {
                const isActive = panel.id === `panel-${tab}`;
                panel.hidden = !isActive;
            });

            const nav = document.querySelector('.nav-sidebar');
            if (nav) {
                const showNav = tab === 'economic';
                nav.classList.toggle('hidden', !showNav);
                nav.setAttribute('aria-hidden', showNav ? 'false' : 'true');
            }

            if (opts.focus) {
                const activeBtn = document.querySelector(`.folder-tab[data-tab="${tab}"]`);
                if (activeBtn) activeBtn.focus();
            }
        }

        function initTabs() {
            const tabs = Array.from(document.querySelectorAll('.folder-tab[role="tab"]'));
            if (!tabs.length) return;

            tabs.forEach((tab) => {
                tab.addEventListener('click', () => setActiveTab(tab.dataset.tab, { focus: false }));
                tab.addEventListener('keydown', (e) => {
                    const idx = tabs.indexOf(tab);
                    if (idx === -1) return;

                    let nextIdx = null;
                    if (e.key === 'ArrowRight') nextIdx = (idx + 1) % tabs.length;
                    if (e.key === 'ArrowLeft') nextIdx = (idx - 1 + tabs.length) % tabs.length;
                    if (e.key === 'Home') nextIdx = 0;
                    if (e.key === 'End') nextIdx = tabs.length - 1;

                    if (nextIdx === null) return;
                    e.preventDefault();
                    const nextTab = tabs[nextIdx];
                    setActiveTab(nextTab.dataset.tab, { focus: true });
                });
            });

            setActiveTab(activeTab, { focus: false });
        }

        function scrollToYear(year) {
            const activePanel = document.querySelector('.tab-panel:not([hidden])');
            if (!activePanel) return;
            const section = activePanel.querySelector(`.section[data-year="${year}"]`);
            if (section) {
                section.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        }

        function initHorizonScrubber() {
            const buttons = Array.from(document.querySelectorAll('.horizon-marker'));
            if (!buttons.length) return;

            buttons.forEach((btn) => {
                btn.addEventListener('click', () => {
                    const year = btn.dataset.year;
                    state.timelineYear = parseInt(year, 10);
                    syncTimelineUI();
                    scrollToYear(year);
                });
                btn.addEventListener('keydown', (e) => {
                    const idx = buttons.indexOf(btn);
                    if (idx === -1) return;

                    let nextIdx = null;
                    if (e.key === 'ArrowRight') nextIdx = Math.min(idx + 1, buttons.length - 1);
                    if (e.key === 'ArrowLeft') nextIdx = Math.max(idx - 1, 0);
                    if (e.key === 'Home') nextIdx = 0;
                    if (e.key === 'End') nextIdx = buttons.length - 1;

                    if (nextIdx === null) return;
                    e.preventDefault();
                    const nextBtn = buttons[nextIdx];
                    setTimelineYear(nextBtn.dataset.year, { animate: false });
                    nextBtn.focus();
                });
            });

            // Snap to a valid marker if state was set to a non-marker value.
            if (!PROJECTION_MARKERS.includes(state.timelineYear)) {
                const snapped = PROJECTION_MARKERS.reduce((best, y) => {
                    if (best === null) return y;
                    return Math.abs(y - state.timelineYear) < Math.abs(best - state.timelineYear) ? y : best;
                }, null);
                state.timelineYear = snapped ?? PROJECTION_MARKERS[0];
            }

            syncTimelineUI();
        }

        // Event Listeners
        document.getElementById('adoption-rate').addEventListener('input', (e) => {
            state.adoptionRate = parseInt(e.target.value);
            document.getElementById('adoption-value').textContent = `${state.adoptionRate} years`;
        });

        document.getElementById('energy-cost').addEventListener('input', (e) => {
            state.energyCost = parseInt(e.target.value);
            document.getElementById('energy-value').textContent = getValueLabel('energy', state.energyCost);
        });

        document.getElementById('payload').addEventListener('input', (e) => {
            state.payload = parseInt(e.target.value);
            document.getElementById('payload-value').textContent = getValueLabel('payload', state.payload);
        });

        document.getElementById('regulation').addEventListener('input', (e) => {
            state.regulation = parseInt(e.target.value);
            document.getElementById('regulation-value').textContent = getValueLabel('regulation', state.regulation);
        });

        document.getElementById('discovery-context').addEventListener('change', (e) => {
            state.discoveryContext = e.target.value;
        });

        document.getElementById('recalculate').addEventListener('click', () => {
            updateUI();
        });

        // Navigation
        document.querySelectorAll('.nav-dot').forEach(dot => {
            dot.addEventListener('click', () => {
                setActiveTab('economic', { focus: false });
                const section = dot.dataset.section;
                const el = document.getElementById(section);
                if (el) {
                    el.scrollIntoView({ behavior: 'smooth' });
                }
            });
        });

        // Update active nav dot on scroll
        let ticking = false;
        window.addEventListener('scroll', () => {
            if (document.body.dataset.activeTab && document.body.dataset.activeTab !== 'economic') return;
            if (!ticking) {
                requestAnimationFrame(() => {
                    const sections = Array.from(document.querySelectorAll('.section, .control-panel, .document-header'))
                        .filter(section => section.offsetParent !== null);
                    let activeSection = 'header';

                    sections.forEach(section => {
                        const rect = section.getBoundingClientRect();
                        if (rect.top < window.innerHeight / 2) {
                            activeSection = section.id;
                        }
                    });

                    document.querySelectorAll('.nav-dot').forEach(dot => {
                        const isActive = dot.dataset.section === activeSection;
                        dot.classList.toggle('active', isActive);
                        dot.setAttribute('aria-current', isActive ? 'true' : 'false');
                    });

                    ticking = false;
                });
                ticking = true;
            }
        });

        // Redacted text reveal - make keyboard accessible
        document.querySelectorAll('.redacted').forEach(el => {
            el.setAttribute('tabindex', '0');
            el.setAttribute('role', 'button');
            el.setAttribute('aria-label', 'Reveal redacted text');

            const toggle = () => {
                el.classList.toggle('revealed');
                const isRevealed = el.classList.contains('revealed');
                el.setAttribute('aria-pressed', isRevealed ? 'true' : 'false');
            };

            el.addEventListener('click', toggle);
            el.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    toggle();
                }
            });
        });

        // Scroll-based year tracking
        function initScrollTracking() {
            const sections = document.querySelectorAll('.section[data-year]');
            if (!sections.length) return;

            const observer = new IntersectionObserver((entries) => {
                let maxRatio = 0;
                let visibleYear = null;

                entries.forEach(entry => {
                    if (entry.isIntersecting && entry.intersectionRatio > maxRatio) {
                        maxRatio = entry.intersectionRatio;
                        visibleYear = parseInt(entry.target.dataset.year, 10);
                    }
                });

                if (visibleYear && visibleYear !== state.timelineYear) {
                    state.timelineYear = visibleYear;
                    syncTimelineUI();
                }
            }, {
                root: null,
                rootMargin: '-20% 0px -60% 0px',
                threshold: [0, 0.25, 0.5, 0.75, 1]
            });

            sections.forEach(section => observer.observe(section));
        }

        // Initialize
        let _initialized = false;
        function init() {
            if (_initialized) return;
            _initialized = true;

            initTabs();
            initHorizonScrubber();
            initScrollTracking();
            syncTimelineUI();
            updateUI();
            renderSparklines();
            filterSectionsByYear(state.timelineYear);

            // Redraw canvas-based visuals on resize (throttled).
            let resizeTicking = false;
            window.addEventListener('resize', () => {
                if (resizeTicking) return;
                resizeTicking = true;
                requestAnimationFrame(() => {
                    resizeTicking = false;
                    renderSparklines();
                    updateTimeSliceVisuals({ animate: false });
                });
            });
        }

        document.addEventListener('DOMContentLoaded', init);

        // Also run immediately in case DOMContentLoaded already fired
        if (document.readyState !== 'loading') init();
    </script>
</body>
</html>
